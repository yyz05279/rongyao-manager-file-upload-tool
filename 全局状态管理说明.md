# å…¨å±€çŠ¶æ€ç®¡ç†è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å…¨å±€çŠ¶æ€ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼ç»Ÿä¸€ç®¡ç†é¡¹ç›®ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯ï¼Œåœ¨æ—¥æŠ¥è¯¦æƒ…å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºå®Œæ•´çš„é¡¹ç›®ä¿¡æ¯ã€‚

## âœ¨ å®ç°çš„åŠŸèƒ½

### 1. å…¨å±€çŠ¶æ€ç®¡ç†ç±»

**æ–‡ä»¶ä½ç½®**ï¼š`services/app_state.py`

**è®¾è®¡æ¨¡å¼**ï¼šå•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- âœ… å…¨å±€å­˜å‚¨é¡¹ç›®ä¿¡æ¯
- âœ… å…¨å±€å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
- âœ… ç»Ÿä¸€çŠ¶æ€è®¿é—®æ¥å£
- âœ… çŠ¶æ€æ¸…ç©ºåŠŸèƒ½

**ç±»ç»“æ„**ï¼š

```python
class AppState:
    """åº”ç”¨å…¨å±€çŠ¶æ€ç®¡ç†ç±»ï¼ˆå•ä¾‹ï¼‰"""

    # å•ä¾‹å®ä¾‹
    _instance = None

    # æ ¸å¿ƒæ–¹æ³•
    def set_project_info(project_info: dict)  # è®¾ç½®é¡¹ç›®ä¿¡æ¯
    def get_project_info() -> dict            # è·å–é¡¹ç›®ä¿¡æ¯
    def set_user_info(user_info: dict)        # è®¾ç½®ç”¨æˆ·ä¿¡æ¯
    def get_user_info() -> dict               # è·å–ç”¨æˆ·ä¿¡æ¯
    def clear()                               # æ¸…ç©ºæ‰€æœ‰çŠ¶æ€
    def has_project_info() -> bool            # æ˜¯å¦æœ‰é¡¹ç›®ä¿¡æ¯
    def has_user_info() -> bool               # æ˜¯å¦æœ‰ç”¨æˆ·ä¿¡æ¯
```

### 2. å•ä¾‹æ¨¡å¼å®ç°

**ç‰¹ç‚¹**ï¼š

- å…¨å±€å”¯ä¸€å®ä¾‹
- çº¿ç¨‹å®‰å…¨
- å»¶è¿Ÿåˆå§‹åŒ–

**å®ç°ä»£ç **ï¼š

```python
def __new__(cls):
    if cls._instance is None:
        cls._instance = super().__new__(cls)
        cls._instance._initialized = False
    return cls._instance

def __init__(self):
    """åˆå§‹åŒ–"""
    if self._initialized:
        return

    self._initialized = True
    self._project_info = None
    self._user_info = None
```

**ä½¿ç”¨æ–¹å¼**ï¼š

```python
# åœ¨ä»»ä½•åœ°æ–¹åˆ›å»ºå®ä¾‹ï¼Œéƒ½ä¼šè¿”å›åŒä¸€ä¸ªå¯¹è±¡
app_state1 = AppState()
app_state2 = AppState()

# app_state1 å’Œ app_state2 æ˜¯åŒä¸€ä¸ªå¯¹è±¡
assert app_state1 is app_state2  # True
```

### 3. ä¸»çª—å£é›†æˆ

**æ–‡ä»¶ä½ç½®**ï¼š`ui/main_window.py`

**ä¿®æ”¹å†…å®¹**ï¼š

#### å¯¼å…¥å…¨å±€çŠ¶æ€

```python
from services.app_state import AppState
```

#### åˆå§‹åŒ–å…¨å±€çŠ¶æ€

```python
def __init__(self):
    super().__init__()
    self.auth_service = AuthService()
    self.config_service = ConfigService()
    self.app_state = AppState()  # å…¨å±€çŠ¶æ€ç®¡ç†
    # ...
```

#### ä¿å­˜é¡¹ç›®ä¿¡æ¯åˆ°å…¨å±€çŠ¶æ€

```python
def fetch_project_info(self):
    """è·å–é¡¹ç›®ä¿¡æ¯"""
    try:
        # è·å–é¡¹ç›®ä¿¡æ¯
        project_service = ProjectService(api_base_url, token)
        self.project_info = project_service.get_my_project()

        # ä¿å­˜åˆ°å…¨å±€çŠ¶æ€
        self.app_state.set_project_info(self.project_info)

        print("âœ… é¡¹ç›®ä¿¡æ¯è·å–æˆåŠŸ\n")
    except Exception as e:
        print(f"âŒ è·å–é¡¹ç›®ä¿¡æ¯å¤±è´¥: {e}\n")
        self.project_info = None
```

#### é€€å‡ºç™»å½•æ—¶æ¸…ç©ºçŠ¶æ€

```python
def on_logout(self):
    """é€€å‡ºç™»å½•å¤„ç†"""
    # ...
    self.app_state.clear()  # æ¸…ç©ºå…¨å±€çŠ¶æ€
    # ...
```

### 4. è¯¦æƒ…å¯¹è¯æ¡†é›†æˆ

**æ–‡ä»¶ä½ç½®**ï¼š`ui/daily_report_detail_dialog.py`

**ä¿®æ”¹å†…å®¹**ï¼š

#### å¯¼å…¥å…¨å±€çŠ¶æ€

```python
from services.app_state import AppState
```

#### åœ¨æ„é€ å‡½æ•°ä¸­è·å–é¡¹ç›®ä¿¡æ¯

```python
def __init__(self, report_data: dict, parent=None):
    super().__init__(parent)
    self.report_data = report_data
    self.app_state = AppState()  # è·å–å…¨å±€çŠ¶æ€
    self.project_info = self.app_state.get_project_info()  # è·å–é¡¹ç›®ä¿¡æ¯
    self.setup_ui()
```

#### æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯

```python
# é¡¹ç›®åç§°ï¼ˆä¼˜å…ˆä»å…¨å±€çŠ¶æ€è·å–ï¼‰
project_name = self.report_data.get('projectName', '-')
if self.project_info:
    project_name = self.project_info.get('name', project_name)
row1.addWidget(self._create_info_label("ğŸ“ é¡¹ç›®:", project_name))

# é¡¹ç›®ç±»å‹å’ŒçŠ¶æ€
if self.project_info:
    project_type = self.project_info.get('typeDisplayName', '-')
    project_status = self.project_info.get('statusDisplayName', '-')
    row1_extra.addWidget(self._create_info_label("ğŸ·ï¸ ç±»å‹:", project_type))
    row1_extra.addWidget(self._create_info_label("ğŸ“Š çŠ¶æ€:", project_status))

# é¡¹ç›®ç»ç†å’Œå®Œæˆåº¦
if self.project_info:
    manager = self.project_info.get('manager', '-')
    completion_progress = self.project_info.get('completionProgress', 0)
    row5.addWidget(self._create_info_label("ğŸ‘¨â€ğŸ’¼ é¡¹ç›®ç»ç†:", manager))
    row5.addWidget(self._create_info_label("ğŸ“ˆ é¡¹ç›®å®Œæˆåº¦:", f"{completion_progress}%"))

# ç†”ç›é‡ä¿¡æ¯
if self.project_info:
    estimated_salt = self.project_info.get('estimatedSaltAmount', 0)
    actual_salt = self.project_info.get('actualSaltAmount', 0)
    row6.addWidget(self._create_info_label("ğŸ¯ è®¡åˆ’ç†”ç›é‡:", f"{estimated_salt} å¨"))
    row6.addWidget(self._create_info_label("âœ… å®é™…ç†”ç›é‡:", f"{actual_salt} å¨"))
```

## ğŸ“Š æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯åŠ¨æµç¨‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   MainWindow.__init__  â”‚
            â”‚   åˆ›å»º AppState å®ä¾‹    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   try_auto_login()     â”‚
            â”‚   æˆ– on_login_success()â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  fetch_project_info()  â”‚
            â”‚  è°ƒç”¨ API è·å–é¡¹ç›®ä¿¡æ¯  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ app_state.set_project_ â”‚
            â”‚ info(project_info)     â”‚
            â”‚ ä¿å­˜åˆ°å…¨å±€çŠ¶æ€          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    ç”¨æˆ·æ“ä½œï¼šåŒå‡»æ—¥æŠ¥é¢„è§ˆ     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ DailyReportDetailDialog      â”‚
         â”‚ åˆ›å»ºå¯¹è¯æ¡†å®ä¾‹                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ app_state = AppState()       â”‚
         â”‚ project_info = app_state.    â”‚
         â”‚ get_project_info()           â”‚
         â”‚ ä»å…¨å±€çŠ¶æ€è·å–é¡¹ç›®ä¿¡æ¯         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ åœ¨å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯ï¼š       â”‚
         â”‚ - é¡¹ç›®åç§°                    â”‚
         â”‚ - é¡¹ç›®ç±»å‹                    â”‚
         â”‚ - é¡¹ç›®çŠ¶æ€                    â”‚
         â”‚ - é¡¹ç›®ç»ç†                    â”‚
         â”‚ - å®Œæˆåº¦                      â”‚
         â”‚ - ç†”ç›é‡                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ é¡¹ç›®ä¿¡æ¯å­—æ®µ

ä» `my-projects` API è·å–çš„é¡¹ç›®ä¿¡æ¯åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µå                | è¯´æ˜               | ç±»å‹   | ç¤ºä¾‹             |
| --------------------- | ------------------ | ------ | ---------------- |
| `id`                  | é¡¹ç›® ID            | int    | 9                |
| `name`                | é¡¹ç›®åç§°           | string | "å°ç›®æ ‡æµ‹è¯•é¡¹ç›®" |
| `type`                | é¡¹ç›®ç±»å‹ï¼ˆåŸå§‹å€¼ï¼‰ | string | "binary"         |
| `typeDisplayName`     | é¡¹ç›®ç±»å‹ï¼ˆæ˜¾ç¤ºåï¼‰ | string | "äºŒå…ƒåŒ–ç›é¡¹ç›®"   |
| `status`              | é¡¹ç›®çŠ¶æ€ï¼ˆåŸå§‹å€¼ï¼‰ | string | "in_progress"    |
| `statusDisplayName`   | é¡¹ç›®çŠ¶æ€ï¼ˆæ˜¾ç¤ºåï¼‰ | string | "è¿›è¡Œä¸­"         |
| `manager`             | é¡¹ç›®ç»ç†           | string | "å¾ç»ç†"         |
| `managerId`           | é¡¹ç›®ç»ç† ID        | int    | 10               |
| `contactPhone`        | è”ç³»ç”µè¯           | string | "13959141232"    |
| `estimatedSaltAmount` | è®¡åˆ’ç†”ç›é‡ï¼ˆå¨ï¼‰   | float  | 50.00            |
| `actualSaltAmount`    | å®é™…ç†”ç›é‡ï¼ˆå¨ï¼‰   | float  | 550.00           |
| `completionProgress`  | å®Œæˆè¿›åº¦ï¼ˆ%ï¼‰      | float  | 999.99           |
| `remainingSaltAmount` | å‰©ä½™ç†”ç›é‡ï¼ˆå¨ï¼‰   | float  | 0.00             |
| `startDate`           | å¼€å§‹æ—¥æœŸ           | string | "2025-09-30"     |
| `endDate`             | è®¡åˆ’ç»“æŸæ—¥æœŸ       | string | "2025-12-31"     |
| `finishDate`          | å®é™…å®Œæˆæ—¥æœŸ       | string | "2025-10-17"     |
| `description`         | é¡¹ç›®æè¿°           | string | "å°ç›®æ ‡æµ‹è¯•"     |

## ğŸ“± ç•Œé¢å±•ç¤º

### æ—¥æŠ¥è¯¦æƒ…å¯¹è¯æ¡† - åŸºæœ¬ä¿¡æ¯é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºæœ¬ä¿¡æ¯                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ“… æ—¥æœŸ: 2025.10.1      ğŸ“ é¡¹ç›®: å°ç›®æ ‡æµ‹è¯•é¡¹ç›®     â”‚
â”‚                                                     â”‚
â”‚  ğŸ·ï¸ ç±»å‹: äºŒå…ƒåŒ–ç›é¡¹ç›®    ğŸ“Š çŠ¶æ€: è¿›è¡Œä¸­           â”‚
â”‚                                                     â”‚
â”‚  ğŸ¯ è¿›åº¦çŠ¶æ€: æ­£å¸¸ğŸŸ¢                                 â”‚
â”‚                                                     â”‚
â”‚  ğŸ“ è¿›åº¦æè¿°: äºŒæœŸé¡¹ç›®åˆå§‹é˜¶æ®µ                       â”‚
â”‚                                                     â”‚
â”‚  ğŸ“‹ ä»»åŠ¡æ•°: 3   ğŸ‘· äººå‘˜æ•°: 15   ğŸšœ æœºæ¢°æ•°: 2   âš ï¸ é—®é¢˜æ•°: 1â”‚
â”‚                                                     â”‚
â”‚  â˜€ï¸ å¤©æ°”: æ™´    ğŸŒ¡ï¸ æ¸©åº¦: 25Â°C                       â”‚
â”‚                                                     â”‚
â”‚  ğŸ‘¨â€ğŸ’¼ é¡¹ç›®ç»ç†: å¾ç»ç†   ğŸ“ˆ é¡¹ç›®å®Œæˆåº¦: 999.99%      â”‚
â”‚                                                     â”‚
â”‚  ğŸ¯ è®¡åˆ’ç†”ç›é‡: 50.0 å¨   âœ… å®é™…ç†”ç›é‡: 550.0 å¨    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ æŠ€æœ¯ä¼˜åŠ¿

### 1. å•ä¾‹æ¨¡å¼çš„å¥½å¤„

**é¿å…é‡å¤åˆ›å»º**ï¼š

```python
# ä¸éœ€è¦å•ä¾‹æ—¶
project_info = fetch_project_info()  # æ¯æ¬¡éƒ½è¦è°ƒç”¨API
dialog1 = Dialog(project_info)
dialog2 = Dialog(project_info)  # éœ€è¦æ‰‹åŠ¨ä¼ é€’

# ä½¿ç”¨å•ä¾‹å
app_state.set_project_info(project_info)  # åªè®¾ç½®ä¸€æ¬¡
dialog1 = Dialog()  # è‡ªåŠ¨è·å–
dialog2 = Dialog()  # è‡ªåŠ¨è·å–
```

**å…¨å±€è®¿é—®**ï¼š

```python
# åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®
class AnyWidget:
    def __init__(self):
        app_state = AppState()
        project_info = app_state.get_project_info()
        # ä½¿ç”¨é¡¹ç›®ä¿¡æ¯
```

**çŠ¶æ€åŒæ­¥**ï¼š

```python
# æ‰€æœ‰åœ°æ–¹çœ‹åˆ°çš„éƒ½æ˜¯æœ€æ–°çŠ¶æ€
app_state.set_project_info(new_info)

# æ‰€æœ‰ç»„ä»¶è‡ªåŠ¨è·å–æœ€æ–°ä¿¡æ¯
widget1 = SomeWidget()  # è·å–åˆ° new_info
widget2 = AnotherWidget()  # ä¹Ÿæ˜¯ new_info
```

### 2. è§£è€¦åˆ

**ä¿®æ”¹å‰**ï¼š

```python
# éœ€è¦å±‚å±‚ä¼ é€’
MainWindow -> UploadWidget -> Dialog(project_info)
```

**ä¿®æ”¹å**ï¼š

```python
# ç›´æ¥ä»å…¨å±€çŠ¶æ€è·å–
MainWindow -> app_state.set_project_info()
Dialog -> app_state.get_project_info()
```

### 3. æ˜“äºç»´æŠ¤

**æ·»åŠ æ–°å­—æ®µ**ï¼š

```python
# åªéœ€è¦åœ¨ AppState ä¸­æ·»åŠ 
def set_config(self, config: dict):
    self._config = config

def get_config(self) -> dict:
    return self._config
```

**ä½¿ç”¨æ–°å­—æ®µ**ï¼š

```python
# ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨
app_state = AppState()
config = app_state.get_config()
```

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### 1. è®¾ç½®é¡¹ç›®ä¿¡æ¯

**åœ¨ä¸»çª—å£ä¸­**ï¼š

```python
def fetch_project_info(self):
    """è·å–é¡¹ç›®ä¿¡æ¯"""
    project_service = ProjectService(api_base_url, token)
    project_info = project_service.get_my_project()

    # ä¿å­˜åˆ°å…¨å±€çŠ¶æ€
    self.app_state.set_project_info(project_info)
```

### 2. è·å–é¡¹ç›®ä¿¡æ¯

**åœ¨ä»»ä½•ç»„ä»¶ä¸­**ï¼š

```python
def __init__(self):
    self.app_state = AppState()
    self.project_info = self.app_state.get_project_info()

    if self.project_info:
        project_name = self.project_info.get('name', '-')
        # ä½¿ç”¨é¡¹ç›®ä¿¡æ¯
```

### 3. æ¸…ç©ºçŠ¶æ€

**é€€å‡ºç™»å½•æ—¶**ï¼š

```python
def on_logout(self):
    """é€€å‡ºç™»å½•"""
    self.app_state.clear()  # æ¸…ç©ºæ‰€æœ‰å…¨å±€çŠ¶æ€
```

### 4. æ£€æŸ¥çŠ¶æ€

**åˆ¤æ–­æ˜¯å¦æœ‰é¡¹ç›®ä¿¡æ¯**ï¼š

```python
if self.app_state.has_project_info():
    # æ˜¾ç¤ºé¡¹ç›®ç›¸å…³å†…å®¹
    self.show_project_info()
else:
    # æ˜¾ç¤ºé»˜è®¤å†…å®¹æˆ–æç¤º
    self.show_default_info()
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. çº¿ç¨‹å®‰å…¨

å½“å‰å®ç°æ˜¯å•çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœéœ€è¦å¤šçº¿ç¨‹è®¿é—®ï¼Œéœ€è¦æ·»åŠ é”ï¼š

```python
import threading

class AppState:
    _instance = None
    _lock = threading.Lock()

    def __new__(cls):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
        return cls._instance
```

### 2. çŠ¶æ€æŒä¹…åŒ–

å½“å‰å®ç°æ˜¯å†…å­˜çŠ¶æ€ï¼Œåº”ç”¨å…³é—­åä¼šä¸¢å¤±ã€‚å¦‚æœéœ€è¦æŒä¹…åŒ–ï¼Œå¯ä»¥ç»“åˆ `ConfigService`ï¼š

```python
def set_project_info(self, project_info: dict):
    """è®¾ç½®é¡¹ç›®ä¿¡æ¯å¹¶æŒä¹…åŒ–"""
    self._project_info = project_info
    # å¯é€‰ï¼šä¿å­˜åˆ°é…ç½®æ–‡ä»¶
    # self.config_service.save_project_info(project_info)
```

### 3. çŠ¶æ€æ›´æ–°æ—¶æœº

- âœ… ç™»å½•æˆåŠŸåç«‹å³æ›´æ–°
- âœ… Token åˆ·æ–°åéœ€è¦é‡æ–°è·å–
- âœ… é€€å‡ºç™»å½•æ—¶æ¸…ç©ºçŠ¶æ€
- âŒ ä¸è¦åœ¨ç•Œé¢åˆå§‹åŒ–æ—¶å°±è®¿é—®ï¼ˆå¯èƒ½è¿˜æ²¡ç™»å½•ï¼‰

### 4. ç©ºå€¼æ£€æŸ¥

å§‹ç»ˆæ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º `None`ï¼š

```python
project_info = app_state.get_project_info()

if project_info:
    # ä½¿ç”¨é¡¹ç›®ä¿¡æ¯
    project_name = project_info.get('name', 'æœªçŸ¥é¡¹ç›®')
else:
    # å¤„ç†æ²¡æœ‰é¡¹ç›®ä¿¡æ¯çš„æƒ…å†µ
    project_name = 'æœªç™»å½•'
```

## ğŸš€ æ‰©å±•å»ºè®®

### 1. æ·»åŠ è§‚å¯Ÿè€…æ¨¡å¼

å½“çŠ¶æ€æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ï¼š

```python
class AppState:
    def __init__(self):
        self._observers = []

    def add_observer(self, callback):
        """æ·»åŠ è§‚å¯Ÿè€…"""
        self._observers.append(callback)

    def set_project_info(self, project_info: dict):
        """è®¾ç½®é¡¹ç›®ä¿¡æ¯"""
        self._project_info = project_info
        self._notify_observers('project_info', project_info)

    def _notify_observers(self, key, value):
        """é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…"""
        for callback in self._observers:
            callback(key, value)
```

**ä½¿ç”¨**ï¼š

```python
def on_project_changed(key, value):
    print(f"é¡¹ç›®ä¿¡æ¯å·²æ›´æ–°: {value}")

app_state.add_observer(on_project_changed)
```

### 2. æ·»åŠ çŠ¶æ€å†å²

è®°å½•çŠ¶æ€å˜åŒ–å†å²ï¼š

```python
class AppState:
    def __init__(self):
        self._history = []

    def set_project_info(self, project_info: dict):
        """è®¾ç½®é¡¹ç›®ä¿¡æ¯"""
        self._history.append({
            'timestamp': datetime.now(),
            'key': 'project_info',
            'value': project_info
        })
        self._project_info = project_info

    def get_history(self):
        """è·å–å†å²è®°å½•"""
        return self._history
```

### 3. æ·»åŠ çŠ¶æ€éªŒè¯

éªŒè¯æ•°æ®æœ‰æ•ˆæ€§ï¼š

```python
def set_project_info(self, project_info: dict):
    """è®¾ç½®é¡¹ç›®ä¿¡æ¯"""
    if not isinstance(project_info, dict):
        raise ValueError("project_info must be a dict")

    required_fields = ['id', 'name']
    for field in required_fields:
        if field not in project_info:
            raise ValueError(f"Missing required field: {field}")

    self._project_info = project_info
```

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### å†…å­˜å ç”¨

- âœ… å•ä¾‹æ¨¡å¼åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå†…å­˜å ç”¨å°
- âœ… åªå­˜å‚¨å¿…è¦çš„æ•°æ®ï¼ˆé¡¹ç›®ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
- âœ… é€€å‡ºç™»å½•æ—¶æ¸…ç©ºæ•°æ®ï¼Œé‡Šæ”¾å†…å­˜

### è®¿é—®é€Ÿåº¦

- âœ… ç›´æ¥å†…å­˜è®¿é—®ï¼Œé€Ÿåº¦æå¿«ï¼ˆçº³ç§’çº§ï¼‰
- âœ… ä¸éœ€è¦ç½‘ç»œè¯·æ±‚ï¼Œæ— å»¶è¿Ÿ
- âœ… é€‚åˆé¢‘ç¹è®¿é—®çš„åœºæ™¯

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

1. âœ… åˆ›å»ºäº†å…¨å±€çŠ¶æ€ç®¡ç†ç±» `AppState`
2. âœ… ä½¿ç”¨å•ä¾‹æ¨¡å¼ç¡®ä¿å…¨å±€å”¯ä¸€å®ä¾‹
3. âœ… åœ¨ä¸»çª—å£ä¸­ä¿å­˜é¡¹ç›®ä¿¡æ¯åˆ°å…¨å±€çŠ¶æ€
4. âœ… åœ¨è¯¦æƒ…å¯¹è¯æ¡†ä¸­ä»å…¨å±€çŠ¶æ€è·å–å¹¶æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
5. âœ… æ˜¾ç¤ºå®Œæ•´çš„é¡¹ç›®è¯¦ç»†ä¿¡æ¯ï¼ˆç±»å‹ã€çŠ¶æ€ã€ç»ç†ã€å®Œæˆåº¦ã€ç†”ç›é‡ç­‰ï¼‰

### ç”¨æˆ·æ”¶ç›Š

1. ğŸ“Š **ä¿¡æ¯æ›´å…¨é¢**ï¼šåœ¨æ—¥æŠ¥è¯¦æƒ…ä¸­æŸ¥çœ‹å®Œæ•´çš„é¡¹ç›®ä¿¡æ¯
2. ğŸ¯ **ä½“éªŒæ›´å¥½**ï¼šæ— éœ€é¢å¤–æ“ä½œï¼Œè‡ªåŠ¨æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
3. ğŸ’¡ **ä¸Šä¸‹æ–‡æ¸…æ™°**ï¼šäº†è§£å½“å‰æ—¥æŠ¥æ‰€å±çš„é¡¹ç›®èƒŒæ™¯

### æŠ€æœ¯ä¼˜åŠ¿

1. ğŸ—ï¸ **æ¶æ„æ¸…æ™°**ï¼šç»Ÿä¸€çš„å…¨å±€çŠ¶æ€ç®¡ç†
2. ğŸ”§ **æ˜“äºç»´æŠ¤**ï¼šè§£è€¦åˆï¼Œä¾¿äºæ‰©å±•
3. ğŸš€ **æ€§èƒ½ä¼˜ç§€**ï¼šå†…å­˜è®¿é—®ï¼Œé€Ÿåº¦å¿«
4. ğŸ“¦ **ä»£ç å¤ç”¨**ï¼šä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®å…¨å±€çŠ¶æ€

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-23  
**ç‰ˆæœ¬**: v2.6  
**çŠ¶æ€**: âœ… å·²å®Œæˆ
