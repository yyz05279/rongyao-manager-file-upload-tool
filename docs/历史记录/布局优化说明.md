# 布局优化说明

## 问题

数据预览表格显示后，顶部和底部都被顶到头了，页面布局不合理。

## 解决方案

### 1. 调整主容器尺寸

**文件**：`tauri-app/src/App.css`

```css
.upload-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 900px;        /* ✅ 从 600px 增加到 900px */
  max-height: 90vh;         /* ✅ 新增：限制最大高度为视窗的 90% */
  overflow-y: auto;         /* ✅ 从 hidden 改为 auto，允许滚动 */
  overflow-x: hidden;       /* ✅ 隐藏横向溢出 */
  margin: 20px;             /* ✅ 新增：添加外边距，不会顶到边缘 */
}
```

### 2. 调整数据预览容器

**文件**：`tauri-app/src/components/DataPreview.css`

```css
.data-preview {
  background-color: #f8f9fa;
  border: 1px solid #e0e0e0;
  border-radius: 5px;
  padding: 15px;
  margin: 15px 0;           /* ✅ 调整外边距 */
  max-height: 500px;        /* ✅ 新增：限制整个预览区域高度 */
  display: flex;            /* ✅ 新增：使用 flex 布局 */
  flex-direction: column;   /* ✅ 新增：垂直方向 */
}

.preview-table-container {
  overflow-x: auto;
  max-height: 350px;        /* ✅ 从 400px 调整到 350px */
  overflow-y: auto;
  margin: 10px 0;           /* ✅ 新增：添加上下边距 */
}
```

### 3. 优化内容区域内边距

**文件**：`tauri-app/src/App.css`

```css
.upload-content {
  padding: 20px 30px 30px 30px;  /* ✅ 调整顶部内边距，减少空白 */
}
```

## 优化效果

### 修改前
```
┌────────────────────────────────────────────────┐
│ 📤 文件上传              👤 徐经理 (项目经理)   │ ← 顶到顶部
├────────────────────────────────────────────────┤
│ [文件路径...]  [选择文件]                       │
│                                                 │
│ 数据预览 (19 条日报)   [✓ 全选] [✗ 反选]       │
│ ┌──────────────────────────────────────────┐   │
│ │ 表格内容（很长，撑满整个屏幕）              │   │
│ │ ...                                       │   │
│ │ ...                                       │   │
│ │ ...（19 行，没有滚动）                     │   │
│ └──────────────────────────────────────────┘   │
│                                                 │
│ [开始上传]                                      │ ← 顶到底部
└────────────────────────────────────────────────┘
```

### 修改后
```
    ↓ 有外边距，不会顶到边缘
┌────────────────────────────────────────────────┐
│ 📤 文件上传              👤 徐经理 (项目经理)   │
├────────────────────────────────────────────────┤
│ 项目: 淮安熔盐储能项目                          │
├────────────────────────────────────────────────┤
│ [文件路径...]  [选择文件]                       │
│                                                 │
│ 数据预览 (19 条日报)   [✓ 全选] [✗ 反选]       │
│ ┌──────────────────────────────────────────┐   │
│ │ ✓  日期    项目    进度  任务  人员...    │ ← 表格头固定
│ ├──────────────────────────────────────────┤   │
│ │ ☐  10.1   淮安    正常   40    0        │   │
│ │ ☐  10.2   淮安    正常   40    0        │   │
│ │ ...                                      │   │
│ │ ...（最多显示 350px 高度，可滚动）         │ ← 表格可滚动
│ │ ↕️                                        │   │
│ └──────────────────────────────────────────┘   │
│                                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━ ← 进度条              │
│                                                 │
│ [开始上传 (0/19)]                               │
│                                                 │
│ ✅ 解析成功！找到 19 条日报                      │
│                                                 │
└────────────────────────────────────────────────┘
    ↑ 有外边距，底部有呼吸空间
```

## 尺寸设置说明

### 容器尺寸
- **主容器宽度**：`max-width: 900px`（可容纳较宽的表格）
- **主容器高度**：`max-height: 90vh`（视窗高度的 90%）
- **外边距**：`margin: 20px`（四周留白）

### 表格尺寸
- **预览区域高度**：`max-height: 500px`（整个预览面板）
- **表格容器高度**：`max-height: 350px`（表格滚动区域）
- **表格头部**：固定在顶部（`position: sticky`）

### 滚动行为
- **主容器**：垂直滚动（`overflow-y: auto`）
- **表格容器**：垂直+横向滚动（`overflow: auto`）
- **平滑滚动**：自动启用

## 响应式设计

在小屏幕上（宽度 < 600px）：
- 容器宽度自适应
- 表格横向可滚动
- 保持合理的内边距

## 测试清单

- [x] 主容器不会顶到浏览器边缘
- [x] 表格高度受限，可以滚动
- [x] 表格头部在滚动时固定
- [x] 底部按钮始终可见
- [x] 整体布局美观，有呼吸感
- [x] 大量数据时（19 条日报）布局正常

## 技术要点

### Flexbox 布局
使用 `display: flex; flex-direction: column` 确保预览区域内部元素垂直排列，高度可控。

### 滚动容器嵌套
```
upload-container (可滚动，90vh)
  └─ upload-content
      └─ data-preview (max-height: 500px)
          └─ preview-table-container (max-height: 350px, 可滚动)
              └─ table (实际内容)
```

### 粘性表头
```css
.preview-table thead {
  position: sticky;
  top: 0;
  z-index: 10;
}
```

确保滚动时表头始终可见。

## 参考 Python 应用

Python 应用使用 QScrollArea 实现滚动：
```python
scroll_area = QScrollArea()
scroll_area.setWidgetResizable(True)
scroll_area.setVerticalScrollBarPolicy(Qt.ScrollBarPolicy.ScrollBarAsNeeded)
```

Tauri 应用使用 CSS 实现相同效果：
```css
overflow-y: auto;  /* 相当于 ScrollBarAsNeeded */
max-height: 90vh;   /* 限制高度，触发滚动 */
```

## 相关文件

- `tauri-app/src/App.css` - 主容器样式
- `tauri-app/src/components/DataPreview.css` - 预览表格样式

## 效果对比

| 项目 | 修改前 | 修改后 |
|------|--------|--------|
| 容器宽度 | 600px | 900px |
| 容器高度 | 无限制 | 90vh（可滚动）|
| 表格高度 | 400px | 350px |
| 外边距 | 无 | 20px |
| 滚动支持 | overflow: hidden | overflow-y: auto |

✅ **优化完成！布局更加合理，用户体验更好。**

