# 记住密码功能说明

## 功能概述

实现了登录页面的"记住密码"功能，用户可以选择保存账号密码，下次登录时自动填充。

## 实现内容

### 1. 前端实现（React）

#### 1.1 登录表单增强

**文件**: `tauri-app/src/components/LoginForm.jsx`

**新增状态**:

```javascript
const [rememberMe, setRememberMe] = useState(false);
```

**自动加载保存的账号密码**:

```javascript
useEffect(() => {
  const savedUsername = localStorage.getItem("savedUsername");
  const savedPassword = localStorage.getItem("savedPassword");
  const savedRememberMe = localStorage.getItem("rememberMe") === "true";

  if (savedRememberMe && savedUsername) {
    setUsername(savedUsername);
    setPassword(savedPassword || "");
    setRememberMe(true);
    console.log("✅ [LoginForm] 已加载保存的账号密码");
  }
}, []);
```

**登录成功后保存或清除账号密码**:

```javascript
// ✅ 如果勾选了"记住密码"，保存账号密码到 localStorage
if (rememberMe) {
  localStorage.setItem("savedUsername", username);
  localStorage.setItem("savedPassword", password);
  localStorage.setItem("rememberMe", "true");
  console.log("✅ [LoginForm] 已保存账号密码");
} else {
  // 如果没有勾选，清除保存的账号密码
  localStorage.removeItem("savedUsername");
  localStorage.removeItem("savedPassword");
  localStorage.removeItem("rememberMe");
  console.log("🗑️ [LoginForm] 已清除保存的账号密码");
}
```

**UI 组件**:

```jsx
<div className="form-group remember-me">
  <label className="checkbox-label">
    <input
      type="checkbox"
      checked={rememberMe}
      onChange={(e) => setRememberMe(e.target.checked)}
      disabled={loading}
    />
    <span>记住密码</span>
  </label>
</div>
```

#### 1.2 样式设计

**文件**: `tauri-app/src/App.css`

```css
/* 记住密码复选框 */
.form-group.remember-me {
  margin-bottom: 15px;
  margin-top: -5px;
}

.checkbox-label {
  display: flex !important;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-weight: normal !important;
  user-select: none;
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #2196f3;
}

.checkbox-label span {
  color: #666;
  font-size: 14px;
}

.checkbox-label:hover span {
  color: #2196f3;
}
```

**样式说明**:

- 复选框大小：18×18px
- 主题色：天蓝色 (#2196F3)
- 悬停效果：文字变为天蓝色
- 禁止选中文字：`user-select: none`
- Flexbox 布局：对齐复选框和文字

### 2. 数据存储

#### 2.1 LocalStorage 键值

| 键名            | 类型   | 说明                | 示例             |
| --------------- | ------ | ------------------- | ---------------- |
| `savedUsername` | String | 保存的用户名/手机号 | "13912326789"    |
| `savedPassword` | String | 保存的密码（明文）  | "password123"    |
| `rememberMe`    | String | 是否记住密码标志    | "true" / "false" |

#### 2.2 安全性说明

**当前实现**:

- 密码以明文形式存储在 localStorage
- 适用于本地桌面应用（Tauri）
- 仅存储在用户本地，不会发送到服务器

**安全性考虑**:

- ⚠️ 密码明文存储，有一定安全风险
- ✅ 仅限本地桌面应用，风险相对较低
- ✅ 用户可选择不勾选"记住密码"

**未来改进建议**:

1. 使用加密存储密码（AES-256）
2. 使用 Tauri 的安全存储 API
3. 仅存储 token，不存储密码
4. 添加密码过期时间

### 3. 用户体验流程

#### 3.1 首次登录

```
用户输入账号密码
    ↓
勾选"记住密码"
    ↓
点击"登录"
    ↓
登录成功
    ↓
保存账号密码到 localStorage
    ↓
跳转到上传页面
```

#### 3.2 再次打开应用

```
打开登录页面
    ↓
自动加载保存的账号密码
    ↓
自动勾选"记住密码"
    ↓
用户可直接点击"登录"
    ↓
或修改账号密码后登录
```

#### 3.3 取消记住密码

```
用户取消勾选"记住密码"
    ↓
点击"登录"
    ↓
登录成功
    ↓
清除 localStorage 中的账号密码
    ↓
下次打开应用需要重新输入
```

### 4. 代码逻辑

#### 4.1 加载逻辑

```javascript
useEffect(() => {
  // 1. 从 localStorage 读取保存的数据
  const savedUsername = localStorage.getItem("savedUsername");
  const savedPassword = localStorage.getItem("savedPassword");
  const savedRememberMe = localStorage.getItem("rememberMe") === "true";

  // 2. 如果勾选了记住密码且有用户名，则自动填充
  if (savedRememberMe && savedUsername) {
    setUsername(savedUsername);
    setPassword(savedPassword || "");
    setRememberMe(true);
    console.log("✅ [LoginForm] 已加载保存的账号密码");
  }
}, []);
```

**判断条件**:

- `savedRememberMe === true` - 用户上次勾选了记住密码
- `savedUsername` 存在 - 有保存的用户名

#### 4.2 保存逻辑

```javascript
if (rememberMe) {
  // 保存账号密码
  localStorage.setItem("savedUsername", username);
  localStorage.setItem("savedPassword", password);
  localStorage.setItem("rememberMe", "true");
} else {
  // 清除账号密码
  localStorage.removeItem("savedUsername");
  localStorage.removeItem("savedPassword");
  localStorage.removeItem("rememberMe");
}
```

**触发时机**:

- 登录成功后立即执行
- 根据 `rememberMe` 状态决定保存或清除

### 5. 修改文件清单

#### 前端文件

✅ `tauri-app/src/components/LoginForm.jsx`

- 添加 `rememberMe` 状态
- 添加 `useEffect` 自动加载保存的账号密码
- 添加"记住密码"复选框
- 登录成功后保存或清除账号密码

✅ `tauri-app/src/App.css`

- 添加 `.form-group.remember-me` 样式
- 添加 `.checkbox-label` 样式
- 添加复选框和悬停效果

#### 后端文件

✅ `tauri-app/src-tauri/src/project.rs`

- 修改 Authorization header，移除 "Bearer " 前缀

✅ `tauri-app/src-tauri/src/upload.rs`

- 修改 Authorization header，移除 "Bearer " 前缀

### 6. 测试步骤

#### 测试 1: 记住密码功能

1. 打开应用，进入登录页面
2. 输入账号：`13912326789`
3. 输入密码：`your_password`
4. ✅ 勾选"记住密码"
5. 点击"登录"
6. 登录成功后，完全关闭应用
7. 重新打开应用
8. **预期结果**：
   - 账号密码自动填充
   - "记住密码"自动勾选

#### 测试 2: 取消记住密码

1. 登录页面已自动填充账号密码
2. ❌ 取消勾选"记住密码"
3. 点击"登录"
4. 登录成功后，完全关闭应用
5. 重新打开应用
6. **预期结果**：
   - 账号密码输入框为空
   - "记住密码"未勾选

#### 测试 3: 修改账号后记住

1. 登录页面已自动填充旧账号密码
2. 修改账号为新账号
3. 输入新密码
4. ✅ 勾选"记住密码"
5. 点击"登录"
6. 登录成功后，完全关闭应用
7. 重新打开应用
8. **预期结果**：
   - 新账号密码自动填充
   - "记住密码"自动勾选

### 7. LocalStorage 数据查看

#### 浏览器开发者工具

打开浏览器控制台（F12），在 Console 中输入：

```javascript
// 查看保存的用户名
console.log(localStorage.getItem("savedUsername"));

// 查看保存的密码
console.log(localStorage.getItem("savedPassword"));

// 查看记住密码标志
console.log(localStorage.getItem("rememberMe"));

// 查看所有保存的登录相关数据
console.log({
  username: localStorage.getItem("savedUsername"),
  password: localStorage.getItem("savedPassword"),
  rememberMe: localStorage.getItem("rememberMe"),
  token: localStorage.getItem("token"),
  refreshToken: localStorage.getItem("refreshToken"),
});
```

#### 清除所有保存的数据

```javascript
// 清除记住的账号密码
localStorage.removeItem("savedUsername");
localStorage.removeItem("savedPassword");
localStorage.removeItem("rememberMe");

// 清除登录 token
localStorage.removeItem("token");
localStorage.removeItem("refreshToken");
localStorage.removeItem("tokenExpiresAt");
localStorage.removeItem("userInfo");

// 清除所有 localStorage（慎用！）
// localStorage.clear();
```

### 8. 安全性增强建议

#### 8.1 密码加密存储

使用 AES 加密密码：

```javascript
// 安装加密库
// npm install crypto-js

import CryptoJS from "crypto-js";

const SECRET_KEY = "your-secret-key-here";

// 加密
const encryptedPassword = CryptoJS.AES.encrypt(password, SECRET_KEY).toString();
localStorage.setItem("savedPassword", encryptedPassword);

// 解密
const decryptedPassword = CryptoJS.AES.decrypt(
  savedPassword,
  SECRET_KEY
).toString(CryptoJS.enc.Utf8);
```

#### 8.2 使用 Tauri 安全存储

```rust
// Tauri 后端可以使用 keyring 库安全存储密码
// Cargo.toml
keyring = "2.0"

// Rust 代码
use keyring::Entry;

// 保存密码
let entry = Entry::new("molten-salt-app", &username)?;
entry.set_password(&password)?;

// 读取密码
let password = entry.get_password()?;
```

#### 8.3 仅存储 Token

更安全的做法是不存储密码，仅存储 token：

```javascript
// 登录成功后
if (rememberMe) {
  localStorage.setItem("savedUsername", username);
  // 不保存密码，仅保存 token（token 本身已存储）
  localStorage.setItem("rememberMe", "true");
}

// 下次打开应用时
// 如果有 token 且未过期，直接使用 token
// 否则显示登录页面，自动填充用户名
```

### 9. 用户提示

可以在登录页面添加安全提示：

```jsx
<div className="security-notice">
  ⚠️ 提示：勾选"记住密码"将把您的账号密码保存在本地设备。
  请勿在公共设备上使用此功能。
</div>
```

**样式**:

```css
.security-notice {
  margin-top: 10px;
  padding: 10px;
  background-color: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: 4px;
  font-size: 12px;
  color: #856404;
  line-height: 1.5;
}
```

## 总结

✅ **记住密码功能已完成**

**功能特点**:

1. ✅ 自动保存账号密码到 localStorage
2. ✅ 下次打开应用自动填充
3. ✅ 用户可选择是否记住密码
4. ✅ 取消勾选时自动清除保存的数据
5. ✅ 美观的复选框样式
6. ✅ 完整的日志输出

**适用场景**:

- ✅ 本地桌面应用
- ✅ 个人设备使用
- ✅ 提升用户体验

**注意事项**:

- ⚠️ 密码明文存储，有一定安全风险
- ⚠️ 不建议在公共设备上使用
- ✅ 可根据需要增强安全性

现在用户可以方便地使用"记住密码"功能了！🔒✨
