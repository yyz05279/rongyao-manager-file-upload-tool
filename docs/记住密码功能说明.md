# è®°ä½å¯†ç åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†ç™»å½•é¡µé¢çš„"è®°ä½å¯†ç "åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä¿å­˜è´¦å·å¯†ç ï¼Œä¸‹æ¬¡ç™»å½•æ—¶è‡ªåŠ¨å¡«å……ã€‚

## å®ç°å†…å®¹

### 1. å‰ç«¯å®ç°ï¼ˆReactï¼‰

#### 1.1 ç™»å½•è¡¨å•å¢å¼º

**æ–‡ä»¶**: `tauri-app/src/components/LoginForm.jsx`

**æ–°å¢çŠ¶æ€**:

```javascript
const [rememberMe, setRememberMe] = useState(false);
```

**è‡ªåŠ¨åŠ è½½ä¿å­˜çš„è´¦å·å¯†ç **:

```javascript
useEffect(() => {
  const savedUsername = localStorage.getItem("savedUsername");
  const savedPassword = localStorage.getItem("savedPassword");
  const savedRememberMe = localStorage.getItem("rememberMe") === "true";

  if (savedRememberMe && savedUsername) {
    setUsername(savedUsername);
    setPassword(savedPassword || "");
    setRememberMe(true);
    console.log("âœ… [LoginForm] å·²åŠ è½½ä¿å­˜çš„è´¦å·å¯†ç ");
  }
}, []);
```

**ç™»å½•æˆåŠŸåä¿å­˜æˆ–æ¸…é™¤è´¦å·å¯†ç **:

```javascript
// âœ… å¦‚æœå‹¾é€‰äº†"è®°ä½å¯†ç "ï¼Œä¿å­˜è´¦å·å¯†ç åˆ° localStorage
if (rememberMe) {
  localStorage.setItem("savedUsername", username);
  localStorage.setItem("savedPassword", password);
  localStorage.setItem("rememberMe", "true");
  console.log("âœ… [LoginForm] å·²ä¿å­˜è´¦å·å¯†ç ");
} else {
  // å¦‚æœæ²¡æœ‰å‹¾é€‰ï¼Œæ¸…é™¤ä¿å­˜çš„è´¦å·å¯†ç 
  localStorage.removeItem("savedUsername");
  localStorage.removeItem("savedPassword");
  localStorage.removeItem("rememberMe");
  console.log("ğŸ—‘ï¸ [LoginForm] å·²æ¸…é™¤ä¿å­˜çš„è´¦å·å¯†ç ");
}
```

**UI ç»„ä»¶**:

```jsx
<div className="form-group remember-me">
  <label className="checkbox-label">
    <input
      type="checkbox"
      checked={rememberMe}
      onChange={(e) => setRememberMe(e.target.checked)}
      disabled={loading}
    />
    <span>è®°ä½å¯†ç </span>
  </label>
</div>
```

#### 1.2 æ ·å¼è®¾è®¡

**æ–‡ä»¶**: `tauri-app/src/App.css`

```css
/* è®°ä½å¯†ç å¤é€‰æ¡† */
.form-group.remember-me {
  margin-bottom: 15px;
  margin-top: -5px;
}

.checkbox-label {
  display: flex !important;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-weight: normal !important;
  user-select: none;
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #2196f3;
}

.checkbox-label span {
  color: #666;
  font-size: 14px;
}

.checkbox-label:hover span {
  color: #2196f3;
}
```

**æ ·å¼è¯´æ˜**:

- å¤é€‰æ¡†å¤§å°ï¼š18Ã—18px
- ä¸»é¢˜è‰²ï¼šå¤©è“è‰² (#2196F3)
- æ‚¬åœæ•ˆæœï¼šæ–‡å­—å˜ä¸ºå¤©è“è‰²
- ç¦æ­¢é€‰ä¸­æ–‡å­—ï¼š`user-select: none`
- Flexbox å¸ƒå±€ï¼šå¯¹é½å¤é€‰æ¡†å’Œæ–‡å­—

### 2. æ•°æ®å­˜å‚¨

#### 2.1 LocalStorage é”®å€¼

| é”®å            | ç±»å‹   | è¯´æ˜                | ç¤ºä¾‹             |
| --------------- | ------ | ------------------- | ---------------- |
| `savedUsername` | String | ä¿å­˜çš„ç”¨æˆ·å/æ‰‹æœºå· | "13912326789"    |
| `savedPassword` | String | ä¿å­˜çš„å¯†ç ï¼ˆæ˜æ–‡ï¼‰  | "password123"    |
| `rememberMe`    | String | æ˜¯å¦è®°ä½å¯†ç æ ‡å¿—    | "true" / "false" |

#### 2.2 å®‰å…¨æ€§è¯´æ˜

**å½“å‰å®ç°**:

- å¯†ç ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨ localStorage
- é€‚ç”¨äºæœ¬åœ°æ¡Œé¢åº”ç”¨ï¼ˆTauriï¼‰
- ä»…å­˜å‚¨åœ¨ç”¨æˆ·æœ¬åœ°ï¼Œä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨

**å®‰å…¨æ€§è€ƒè™‘**:

- âš ï¸ å¯†ç æ˜æ–‡å­˜å‚¨ï¼Œæœ‰ä¸€å®šå®‰å…¨é£é™©
- âœ… ä»…é™æœ¬åœ°æ¡Œé¢åº”ç”¨ï¼Œé£é™©ç›¸å¯¹è¾ƒä½
- âœ… ç”¨æˆ·å¯é€‰æ‹©ä¸å‹¾é€‰"è®°ä½å¯†ç "

**æœªæ¥æ”¹è¿›å»ºè®®**:

1. ä½¿ç”¨åŠ å¯†å­˜å‚¨å¯†ç ï¼ˆAES-256ï¼‰
2. ä½¿ç”¨ Tauri çš„å®‰å…¨å­˜å‚¨ API
3. ä»…å­˜å‚¨ tokenï¼Œä¸å­˜å‚¨å¯†ç 
4. æ·»åŠ å¯†ç è¿‡æœŸæ—¶é—´

### 3. ç”¨æˆ·ä½“éªŒæµç¨‹

#### 3.1 é¦–æ¬¡ç™»å½•

```
ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç 
    â†“
å‹¾é€‰"è®°ä½å¯†ç "
    â†“
ç‚¹å‡»"ç™»å½•"
    â†“
ç™»å½•æˆåŠŸ
    â†“
ä¿å­˜è´¦å·å¯†ç åˆ° localStorage
    â†“
è·³è½¬åˆ°ä¸Šä¼ é¡µé¢
```

#### 3.2 å†æ¬¡æ‰“å¼€åº”ç”¨

```
æ‰“å¼€ç™»å½•é¡µé¢
    â†“
è‡ªåŠ¨åŠ è½½ä¿å­˜çš„è´¦å·å¯†ç 
    â†“
è‡ªåŠ¨å‹¾é€‰"è®°ä½å¯†ç "
    â†“
ç”¨æˆ·å¯ç›´æ¥ç‚¹å‡»"ç™»å½•"
    â†“
æˆ–ä¿®æ”¹è´¦å·å¯†ç åç™»å½•
```

#### 3.3 å–æ¶ˆè®°ä½å¯†ç 

```
ç”¨æˆ·å–æ¶ˆå‹¾é€‰"è®°ä½å¯†ç "
    â†“
ç‚¹å‡»"ç™»å½•"
    â†“
ç™»å½•æˆåŠŸ
    â†“
æ¸…é™¤ localStorage ä¸­çš„è´¦å·å¯†ç 
    â†“
ä¸‹æ¬¡æ‰“å¼€åº”ç”¨éœ€è¦é‡æ–°è¾“å…¥
```

### 4. ä»£ç é€»è¾‘

#### 4.1 åŠ è½½é€»è¾‘

```javascript
useEffect(() => {
  // 1. ä» localStorage è¯»å–ä¿å­˜çš„æ•°æ®
  const savedUsername = localStorage.getItem("savedUsername");
  const savedPassword = localStorage.getItem("savedPassword");
  const savedRememberMe = localStorage.getItem("rememberMe") === "true";

  // 2. å¦‚æœå‹¾é€‰äº†è®°ä½å¯†ç ä¸”æœ‰ç”¨æˆ·åï¼Œåˆ™è‡ªåŠ¨å¡«å……
  if (savedRememberMe && savedUsername) {
    setUsername(savedUsername);
    setPassword(savedPassword || "");
    setRememberMe(true);
    console.log("âœ… [LoginForm] å·²åŠ è½½ä¿å­˜çš„è´¦å·å¯†ç ");
  }
}, []);
```

**åˆ¤æ–­æ¡ä»¶**:

- `savedRememberMe === true` - ç”¨æˆ·ä¸Šæ¬¡å‹¾é€‰äº†è®°ä½å¯†ç 
- `savedUsername` å­˜åœ¨ - æœ‰ä¿å­˜çš„ç”¨æˆ·å

#### 4.2 ä¿å­˜é€»è¾‘

```javascript
if (rememberMe) {
  // ä¿å­˜è´¦å·å¯†ç 
  localStorage.setItem("savedUsername", username);
  localStorage.setItem("savedPassword", password);
  localStorage.setItem("rememberMe", "true");
} else {
  // æ¸…é™¤è´¦å·å¯†ç 
  localStorage.removeItem("savedUsername");
  localStorage.removeItem("savedPassword");
  localStorage.removeItem("rememberMe");
}
```

**è§¦å‘æ—¶æœº**:

- ç™»å½•æˆåŠŸåç«‹å³æ‰§è¡Œ
- æ ¹æ® `rememberMe` çŠ¶æ€å†³å®šä¿å­˜æˆ–æ¸…é™¤

### 5. ä¿®æ”¹æ–‡ä»¶æ¸…å•

#### å‰ç«¯æ–‡ä»¶

âœ… `tauri-app/src/components/LoginForm.jsx`

- æ·»åŠ  `rememberMe` çŠ¶æ€
- æ·»åŠ  `useEffect` è‡ªåŠ¨åŠ è½½ä¿å­˜çš„è´¦å·å¯†ç 
- æ·»åŠ "è®°ä½å¯†ç "å¤é€‰æ¡†
- ç™»å½•æˆåŠŸåä¿å­˜æˆ–æ¸…é™¤è´¦å·å¯†ç 

âœ… `tauri-app/src/App.css`

- æ·»åŠ  `.form-group.remember-me` æ ·å¼
- æ·»åŠ  `.checkbox-label` æ ·å¼
- æ·»åŠ å¤é€‰æ¡†å’Œæ‚¬åœæ•ˆæœ

#### åç«¯æ–‡ä»¶

âœ… `tauri-app/src-tauri/src/project.rs`

- ä¿®æ”¹ Authorization headerï¼Œç§»é™¤ "Bearer " å‰ç¼€

âœ… `tauri-app/src-tauri/src/upload.rs`

- ä¿®æ”¹ Authorization headerï¼Œç§»é™¤ "Bearer " å‰ç¼€

### 6. æµ‹è¯•æ­¥éª¤

#### æµ‹è¯• 1: è®°ä½å¯†ç åŠŸèƒ½

1. æ‰“å¼€åº”ç”¨ï¼Œè¿›å…¥ç™»å½•é¡µé¢
2. è¾“å…¥è´¦å·ï¼š`13912326789`
3. è¾“å…¥å¯†ç ï¼š`your_password`
4. âœ… å‹¾é€‰"è®°ä½å¯†ç "
5. ç‚¹å‡»"ç™»å½•"
6. ç™»å½•æˆåŠŸåï¼Œå®Œå…¨å…³é—­åº”ç”¨
7. é‡æ–°æ‰“å¼€åº”ç”¨
8. **é¢„æœŸç»“æœ**ï¼š
   - è´¦å·å¯†ç è‡ªåŠ¨å¡«å……
   - "è®°ä½å¯†ç "è‡ªåŠ¨å‹¾é€‰

#### æµ‹è¯• 2: å–æ¶ˆè®°ä½å¯†ç 

1. ç™»å½•é¡µé¢å·²è‡ªåŠ¨å¡«å……è´¦å·å¯†ç 
2. âŒ å–æ¶ˆå‹¾é€‰"è®°ä½å¯†ç "
3. ç‚¹å‡»"ç™»å½•"
4. ç™»å½•æˆåŠŸåï¼Œå®Œå…¨å…³é—­åº”ç”¨
5. é‡æ–°æ‰“å¼€åº”ç”¨
6. **é¢„æœŸç»“æœ**ï¼š
   - è´¦å·å¯†ç è¾“å…¥æ¡†ä¸ºç©º
   - "è®°ä½å¯†ç "æœªå‹¾é€‰

#### æµ‹è¯• 3: ä¿®æ”¹è´¦å·åè®°ä½

1. ç™»å½•é¡µé¢å·²è‡ªåŠ¨å¡«å……æ—§è´¦å·å¯†ç 
2. ä¿®æ”¹è´¦å·ä¸ºæ–°è´¦å·
3. è¾“å…¥æ–°å¯†ç 
4. âœ… å‹¾é€‰"è®°ä½å¯†ç "
5. ç‚¹å‡»"ç™»å½•"
6. ç™»å½•æˆåŠŸåï¼Œå®Œå…¨å…³é—­åº”ç”¨
7. é‡æ–°æ‰“å¼€åº”ç”¨
8. **é¢„æœŸç»“æœ**ï¼š
   - æ–°è´¦å·å¯†ç è‡ªåŠ¨å¡«å……
   - "è®°ä½å¯†ç "è‡ªåŠ¨å‹¾é€‰

### 7. LocalStorage æ•°æ®æŸ¥çœ‹

#### æµè§ˆå™¨å¼€å‘è€…å·¥å…·

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œåœ¨ Console ä¸­è¾“å…¥ï¼š

```javascript
// æŸ¥çœ‹ä¿å­˜çš„ç”¨æˆ·å
console.log(localStorage.getItem("savedUsername"));

// æŸ¥çœ‹ä¿å­˜çš„å¯†ç 
console.log(localStorage.getItem("savedPassword"));

// æŸ¥çœ‹è®°ä½å¯†ç æ ‡å¿—
console.log(localStorage.getItem("rememberMe"));

// æŸ¥çœ‹æ‰€æœ‰ä¿å­˜çš„ç™»å½•ç›¸å…³æ•°æ®
console.log({
  username: localStorage.getItem("savedUsername"),
  password: localStorage.getItem("savedPassword"),
  rememberMe: localStorage.getItem("rememberMe"),
  token: localStorage.getItem("token"),
  refreshToken: localStorage.getItem("refreshToken"),
});
```

#### æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®

```javascript
// æ¸…é™¤è®°ä½çš„è´¦å·å¯†ç 
localStorage.removeItem("savedUsername");
localStorage.removeItem("savedPassword");
localStorage.removeItem("rememberMe");

// æ¸…é™¤ç™»å½• token
localStorage.removeItem("token");
localStorage.removeItem("refreshToken");
localStorage.removeItem("tokenExpiresAt");
localStorage.removeItem("userInfo");

// æ¸…é™¤æ‰€æœ‰ localStorageï¼ˆæ…ç”¨ï¼ï¼‰
// localStorage.clear();
```

### 8. å®‰å…¨æ€§å¢å¼ºå»ºè®®

#### 8.1 å¯†ç åŠ å¯†å­˜å‚¨

ä½¿ç”¨ AES åŠ å¯†å¯†ç ï¼š

```javascript
// å®‰è£…åŠ å¯†åº“
// npm install crypto-js

import CryptoJS from "crypto-js";

const SECRET_KEY = "your-secret-key-here";

// åŠ å¯†
const encryptedPassword = CryptoJS.AES.encrypt(password, SECRET_KEY).toString();
localStorage.setItem("savedPassword", encryptedPassword);

// è§£å¯†
const decryptedPassword = CryptoJS.AES.decrypt(
  savedPassword,
  SECRET_KEY
).toString(CryptoJS.enc.Utf8);
```

#### 8.2 ä½¿ç”¨ Tauri å®‰å…¨å­˜å‚¨

```rust
// Tauri åç«¯å¯ä»¥ä½¿ç”¨ keyring åº“å®‰å…¨å­˜å‚¨å¯†ç 
// Cargo.toml
keyring = "2.0"

// Rust ä»£ç 
use keyring::Entry;

// ä¿å­˜å¯†ç 
let entry = Entry::new("molten-salt-app", &username)?;
entry.set_password(&password)?;

// è¯»å–å¯†ç 
let password = entry.get_password()?;
```

#### 8.3 ä»…å­˜å‚¨ Token

æ›´å®‰å…¨çš„åšæ³•æ˜¯ä¸å­˜å‚¨å¯†ç ï¼Œä»…å­˜å‚¨ tokenï¼š

```javascript
// ç™»å½•æˆåŠŸå
if (rememberMe) {
  localStorage.setItem("savedUsername", username);
  // ä¸ä¿å­˜å¯†ç ï¼Œä»…ä¿å­˜ tokenï¼ˆtoken æœ¬èº«å·²å­˜å‚¨ï¼‰
  localStorage.setItem("rememberMe", "true");
}

// ä¸‹æ¬¡æ‰“å¼€åº”ç”¨æ—¶
// å¦‚æœæœ‰ token ä¸”æœªè¿‡æœŸï¼Œç›´æ¥ä½¿ç”¨ token
// å¦åˆ™æ˜¾ç¤ºç™»å½•é¡µé¢ï¼Œè‡ªåŠ¨å¡«å……ç”¨æˆ·å
```

### 9. ç”¨æˆ·æç¤º

å¯ä»¥åœ¨ç™»å½•é¡µé¢æ·»åŠ å®‰å…¨æç¤ºï¼š

```jsx
<div className="security-notice">
  âš ï¸ æç¤ºï¼šå‹¾é€‰"è®°ä½å¯†ç "å°†æŠŠæ‚¨çš„è´¦å·å¯†ç ä¿å­˜åœ¨æœ¬åœ°è®¾å¤‡ã€‚
  è¯·å‹¿åœ¨å…¬å…±è®¾å¤‡ä¸Šä½¿ç”¨æ­¤åŠŸèƒ½ã€‚
</div>
```

**æ ·å¼**:

```css
.security-notice {
  margin-top: 10px;
  padding: 10px;
  background-color: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: 4px;
  font-size: 12px;
  color: #856404;
  line-height: 1.5;
}
```

## æ€»ç»“

âœ… **è®°ä½å¯†ç åŠŸèƒ½å·²å®Œæˆ**

**åŠŸèƒ½ç‰¹ç‚¹**:

1. âœ… è‡ªåŠ¨ä¿å­˜è´¦å·å¯†ç åˆ° localStorage
2. âœ… ä¸‹æ¬¡æ‰“å¼€åº”ç”¨è‡ªåŠ¨å¡«å……
3. âœ… ç”¨æˆ·å¯é€‰æ‹©æ˜¯å¦è®°ä½å¯†ç 
4. âœ… å–æ¶ˆå‹¾é€‰æ—¶è‡ªåŠ¨æ¸…é™¤ä¿å­˜çš„æ•°æ®
5. âœ… ç¾è§‚çš„å¤é€‰æ¡†æ ·å¼
6. âœ… å®Œæ•´çš„æ—¥å¿—è¾“å‡º

**é€‚ç”¨åœºæ™¯**:

- âœ… æœ¬åœ°æ¡Œé¢åº”ç”¨
- âœ… ä¸ªäººè®¾å¤‡ä½¿ç”¨
- âœ… æå‡ç”¨æˆ·ä½“éªŒ

**æ³¨æ„äº‹é¡¹**:

- âš ï¸ å¯†ç æ˜æ–‡å­˜å‚¨ï¼Œæœ‰ä¸€å®šå®‰å…¨é£é™©
- âš ï¸ ä¸å»ºè®®åœ¨å…¬å…±è®¾å¤‡ä¸Šä½¿ç”¨
- âœ… å¯æ ¹æ®éœ€è¦å¢å¼ºå®‰å…¨æ€§

ç°åœ¨ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨"è®°ä½å¯†ç "åŠŸèƒ½äº†ï¼ğŸ”’âœ¨
