# 中文界面支持说明

## 📋 功能概述

实现了完整的中文界面支持，包括系统对话框、文件选择器和所有提示框的按钮都显示为中文。

## ✨ 实现的功能

### 1. Qt 翻译文件加载

在主程序中加载 Qt 的中文翻译文件，使所有 Qt 系统组件自动显示中文。

**实现位置**：`main.py`

**关键代码**：

```python
from PyQt6.QtCore import QTranslator, QLocale, QLibraryInfo

# 创建翻译器
translator = QTranslator()

# 加载Qt基础库的中文翻译
qt_translator_path = QLibraryInfo.path(QLibraryInfo.LibraryPath.TranslationsPath)
if translator.load("qtbase_zh_CN", qt_translator_path):
    app.installTranslator(translator)

# 设置区域为中文
QLocale.setDefault(QLocale(QLocale.Language.Chinese, QLocale.Country.China))
```

### 2. 自定义对话框按钮文本

将所有标准对话框的按钮文本手动设置为友好的中文。

**按钮映射**：

- `Yes` → "确定"
- `No` → "取消"

**示例代码**：

```python
msg_box = QMessageBox(self)
msg_box.setIcon(QMessageBox.Icon.Question)
msg_box.setWindowTitle("确认操作")
msg_box.setText("确定要执行此操作吗？")
msg_box.setStandardButtons(QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No)

# 设置按钮文本为中文
yes_button = msg_box.button(QMessageBox.StandardButton.Yes)
yes_button.setText("确定")
no_button = msg_box.button(QMessageBox.StandardButton.No)
no_button.setText("取消")

reply = msg_box.exec()
```

## 🎯 影响的界面元素

### 1. 文件选择对话框

**修改前**：

```
选择文件对话框按钮：
- Open
- Cancel
```

**修改后**：

```
选择文件对话框按钮：
- 打开
- 取消
```

**效果**：

- 文件类型过滤器显示中文
- 按钮显示中文
- 文件夹名称显示为中文（如果系统是中文）

### 2. 确认对话框

#### 退出登录确认

```
┌─────────────────────┐
│ 确认退出            │
├─────────────────────┤
│ 确定要退出登录吗？  │
├─────────────────────┤
│  [确定]   [取消]    │
└─────────────────────┘
```

#### 清空列表确认

```
┌─────────────────────┐
│ 确认清空            │
├─────────────────────┤
│ 确定要清空文件列表  │
│ 吗？                │
├─────────────────────┤
│  [确定]   [取消]    │
└─────────────────────┘
```

#### 上传确认

```
┌─────────────────────┐
│ 确认上传            │
├─────────────────────┤
│ 确定要上传 X 条日报 │
│ 记录吗？            │
├─────────────────────┤
│  [确定]   [取消]    │
└─────────────────────┘
```

#### 退出程序确认

```
┌─────────────────────┐
│ 确认退出            │
├─────────────────────┤
│ 还有文件正在上传，  │
│ 确定要退出吗？      │
├─────────────────────┤
│  [确定]   [取消]    │
└─────────────────────┘
```

### 3. 提示对话框

所有 `QMessageBox` 类型的对话框：

- ✅ Warning（警告）
- ✅ Information（信息）
- ✅ Critical（错误）
- ✅ Question（询问）

**按钮显示**：

- "确定" 代替 "OK"
- "取消" 代替 "Cancel"
- "是" 代替 "Yes"
- "否" 代替 "No"

## 📂 修改的文件

### 1. main.py

**新增导入**：

```python
from PyQt6.QtCore import QTranslator, QLocale, QLibraryInfo
```

**新增功能**：

- 加载 Qt 中文翻译文件
- 设置默认区域为中文
- 翻译文件查找逻辑（支持不同安装路径）

### 2. ui/main_window.py

**修改对话框**：

- 退出登录确认对话框
- 关闭程序确认对话框

**改动内容**：

- 使用 `QMessageBox` 实例化代替 `QMessageBox.question()`
- 手动设置按钮文本

### 3. ui/upload_widget.py

**修改对话框**：

- 清空列表确认对话框
- 上传确认对话框

**改动内容**：

- 使用 `QMessageBox` 实例化代替 `QMessageBox.question()`
- 手动设置按钮文本

## 🔧 翻译文件查找策略

### 策略 1：从 Qt 安装目录加载

```python
qt_translator_path = QLibraryInfo.path(QLibraryInfo.LibraryPath.TranslationsPath)
translator.load("qtbase_zh_CN", qt_translator_path)
```

**路径示例**（macOS）：

```
/opt/homebrew/Cellar/qt@6/6.x.x/translations/
```

### 策略 2：从 PyQt6 包目录加载

```python
import PyQt6
pyqt6_path = os.path.dirname(PyQt6.__file__)
translations_path = os.path.join(pyqt6_path, "Qt6", "translations")
translator.load("qtbase_zh_CN", translations_path)
```

**路径示例**（macOS）：

```
/Library/Frameworks/Python.framework/Versions/3.x/lib/python3.x/site-packages/PyQt6/Qt6/translations/
```

### 容错处理

如果找不到翻译文件：

```
⚠️ 未找到Qt中文翻译文件，将使用默认英文
```

程序仍然可以正常运行，只是系统对话框使用英文。

## 📊 对比效果

### 文件选择对话框

**修改前**：

```
Title: Open File
Buttons: [Open] [Cancel]
Filter: Excel Files (*.xlsx *.xls)
```

**修改后**：

```
标题: 打开文件
按钮: [打开] [取消]
过滤器: Excel 文件 (*.xlsx *.xls)
```

### 确认对话框

**修改前**：

```
Title: Confirm
Message: Are you sure?
Buttons: [Yes] [No]
```

**修改后**：

```
标题: 确认操作
消息: 确定要执行此操作吗？
按钮: [确定] [取消]
```

## 💡 使用示例

### 创建中文确认对话框

```python
def confirm_action(parent, title: str, message: str) -> bool:
    """
    显示确认对话框

    :param parent: 父窗口
    :param title: 对话框标题
    :param message: 提示消息
    :return: 用户点击确定返回True，否则返回False
    """
    msg_box = QMessageBox(parent)
    msg_box.setIcon(QMessageBox.Icon.Question)
    msg_box.setWindowTitle(title)
    msg_box.setText(message)
    msg_box.setStandardButtons(
        QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No
    )
    msg_box.setDefaultButton(QMessageBox.StandardButton.No)

    # 设置按钮文本为中文
    yes_button = msg_box.button(QMessageBox.StandardButton.Yes)
    yes_button.setText("确定")
    no_button = msg_box.button(QMessageBox.StandardButton.No)
    no_button.setText("取消")

    return msg_box.exec() == QMessageBox.StandardButton.Yes
```

**使用**：

```python
if confirm_action(self, "确认删除", "确定要删除这个文件吗？"):
    # 执行删除操作
    delete_file()
```

### 创建中文警告对话框

```python
def show_warning(parent, title: str, message: str):
    """显示警告对话框"""
    msg_box = QMessageBox(parent)
    msg_box.setIcon(QMessageBox.Icon.Warning)
    msg_box.setWindowTitle(title)
    msg_box.setText(message)
    msg_box.setStandardButtons(QMessageBox.StandardButton.Ok)

    # 设置按钮文本
    ok_button = msg_box.button(QMessageBox.StandardButton.Ok)
    ok_button.setText("确定")

    msg_box.exec()
```

### 创建中文信息对话框

```python
def show_info(parent, title: str, message: str):
    """显示信息对话框"""
    msg_box = QMessageBox(parent)
    msg_box.setIcon(QMessageBox.Icon.Information)
    msg_box.setWindowTitle(title)
    msg_box.setText(message)
    msg_box.setStandardButtons(QMessageBox.StandardButton.Ok)

    # 设置按钮文本
    ok_button = msg_box.button(QMessageBox.StandardButton.Ok)
    ok_button.setText("确定")

    msg_box.exec()
```

## 🌍 区域设置

### 设置默认区域

```python
QLocale.setDefault(QLocale(QLocale.Language.Chinese, QLocale.Country.China))
```

**影响**：

- 日期格式：2025-10-23 → 2025 年 10 月 23 日
- 时间格式：14:30:00 → 下午 2:30:00
- 数字格式：1,234.56 → 1,234.56（保持不变）
- 货币格式：$1,234.56 → ¥1,234.56

## 🧪 测试建议

### 功能测试

1. **文件选择对话框测试**

   - 点击"添加文件"按钮
   - 验证对话框标题和按钮为中文
   - 验证文件类型过滤器为中文

2. **确认对话框测试**

   - 点击"清空列表"
   - 验证确认对话框为中文
   - 点击"退出登录"
   - 验证确认对话框为中文

3. **提示对话框测试**
   - 触发各种错误提示
   - 验证按钮为中文

### 兼容性测试

1. **macOS**

   - 验证翻译文件加载成功
   - 验证所有对话框显示中文

2. **Windows**

   - 验证翻译文件加载成功
   - 验证所有对话框显示中文

3. **Linux**
   - 验证翻译文件加载成功
   - 验证所有对话框显示中文

## 📝 注意事项

### 1. 翻译文件依赖

项目依赖 Qt 的中文翻译文件 `qtbase_zh_CN.qm`。

**安装方式**：

**macOS (Homebrew)**：

```bash
brew install qt@6
```

**Ubuntu/Debian**：

```bash
sudo apt-get install qt6-translations-l10n
```

**Windows**：
Qt 翻译文件通常随 PyQt6 一起安装。

### 2. 打包注意事项

使用 PyInstaller 打包时，需要包含翻译文件：

```python
# 在 .spec 文件中添加
datas=[
    ('path/to/translations/*.qm', 'translations'),
],
```

或在打包命令中添加：

```bash
pyinstaller --add-data "translations:translations" main.py
```

### 3. 自定义翻译

如果需要翻译自定义文本，可以使用 `QTranslator`：

```python
app_translator = QTranslator()
app_translator.load("myapp_zh_CN.qm")
app.installTranslator(app_translator)
```

## 🎨 按钮文本规范

为了保持一致性，建议使用以下中文按钮文本：

| 英文   | 中文 | 使用场景  |
| ------ | ---- | --------- |
| OK     | 确定 | 确认操作  |
| Cancel | 取消 | 取消操作  |
| Yes    | 是   | 是/否选择 |
| No     | 否   | 是/否选择 |
| Apply  | 应用 | 应用设置  |
| Close  | 关闭 | 关闭窗口  |
| Save   | 保存 | 保存文件  |
| Open   | 打开 | 打开文件  |
| Delete | 删除 | 删除操作  |
| Retry  | 重试 | 重试操作  |

## 🚀 后续优化建议

### 1. 创建工具函数

创建统一的对话框工具类，简化代码：

```python
class DialogHelper:
    @staticmethod
    def confirm(parent, title, message):
        """确认对话框"""
        # ... 实现

    @staticmethod
    def warning(parent, title, message):
        """警告对话框"""
        # ... 实现
```

### 2. 支持多语言切换

添加语言切换功能，支持中文/英文切换。

### 3. 完善翻译覆盖

翻译所有硬编码的英文字符串。

---

**更新日期**: 2025-10-23  
**版本**: v2.4  
**状态**: ✅ 已完成
