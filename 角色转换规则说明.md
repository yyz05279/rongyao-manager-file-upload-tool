# 角色转换规则说明

## 概述

用户角色字段 `role` 在后端返回的是英文常量（如 `MANAGER`），需要在前端转换为中文显示。

## 角色映射表

| 后端值 (role) | 中文显示 | 说明                   |
| ------------- | -------- | ---------------------- |
| `MANAGER`     | 项目经理 | 项目管理人员           |
| `ADMIN`       | 管理员   | 系统管理员             |
| `OPERATOR`    | 运维人员 | 日常运维操作人员       |
| 其他          | 保持原样 | 未知角色直接显示后端值 |

## Python 实现

参考文件：`docs/用户信息显示优化说明.md`

```python
# 角色映射字典
role_map = {
    'ADMIN': '管理员',
    'MANAGER': '项目经理',
    'OPERATOR': '运维人员'
}

# 获取角色显示文本
role_text = role_map.get(role, role)  # 如果找不到，使用原值
```

## Tauri (React) 实现

文件：`tauri-app/src/components/UploadForm.jsx`

```jsx
export function UploadForm() {
  // 角色映射（参考 Python 代码）
  const roleMap = {
    ADMIN: "管理员",
    MANAGER: "项目经理",
    OPERATOR: "运维人员",
  };

  const getRoleText = (role) => {
    return roleMap[role] || role;
  };

  // 在 JSX 中使用
  return (
    <div className="user-info">
      <span>
        👤 {userInfo?.name || userInfo?.username}
        {userInfo?.role && ` (${getRoleText(userInfo.role)})`}
      </span>
    </div>
  );
}
```

## 显示示例

### 后端返回数据

```json
{
  "data": {
    "user": {
      "id": 10,
      "username": "13959141232",
      "name": "徐经理",
      "email": null,
      "role": "MANAGER"
    }
  }
}
```

### 前端显示效果

```
👤 徐经理 (项目经理)
```

## 实现特点

1. **Fallback 处理**：如果后端返回未知角色，直接显示原值
2. **可扩展性**：添加新角色只需在 `roleMap` 中增加映射
3. **一致性**：Python 和 Tauri 使用相同的映射规则

## 测试用例

| role 值        | 期望显示                 |
| -------------- | ------------------------ |
| `MANAGER`      | 项目经理                 |
| `ADMIN`        | 管理员                   |
| `OPERATOR`     | 运维人员                 |
| `UNKNOWN_ROLE` | UNKNOWN_ROLE（保持原样） |
| `null`         | 不显示角色部分           |
| `undefined`    | 不显示角色部分           |

## 相关文件

- Python 实现：`ui/upload_widget.py`
- Python 文档：`docs/用户信息显示优化说明.md`
- Tauri 实现：`tauri-app/src/components/UploadForm.jsx`
- Rust 数据结构：`tauri-app/src-tauri/src/auth.rs`

## 注意事项

1. 角色值区分大小写，必须使用大写（`MANAGER` 而不是 `manager`）
2. 后端 API 必须在登录响应中返回 `role` 字段
3. 如果后端没有返回 `role` 字段，不会显示角色部分（优雅降级）
