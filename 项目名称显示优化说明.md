# é¡¹ç›®åç§°æ˜¾ç¤ºä¼˜åŒ–è¯´æ˜

## éœ€æ±‚

1. ç”¨æˆ·ç™»å½•åï¼Œè°ƒç”¨ `my-project` æ¥å£è·å–å½“å‰é¡¹ç›®ä¿¡æ¯
2. åœ¨ç”¨æˆ·ä¿¡æ¯é‚£ä¸€è¡Œå±•ç¤ºé¡¹ç›®åç§°
3. åœ¨ Excel æ•°æ®é¢„è§ˆçš„é¡¹ç›®åç§°åˆ—å±•ç¤ºæ¥å£è¿”å›çš„é¡¹ç›®åç§°ï¼ˆè€Œä¸æ˜¯ Excel ä¸­è§£æçš„åç§°ï¼‰

## å®ç°æ–¹æ¡ˆ

### 1. åœ¨ç”¨æˆ·ä¿¡æ¯è¡Œæ˜¾ç¤ºé¡¹ç›®åç§°

**æ–‡ä»¶**ï¼š`tauri-app/src/components/UploadForm.jsx`

å‚è€ƒ Python ä»£ç ä¸­çš„å®ç°ï¼š

```python
# Python ä»£ç ï¼ˆui/upload_widget.pyï¼‰
# ä½¿ç”¨æ°´å¹³å¸ƒå±€ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å’Œé¡¹ç›®ä¿¡æ¯æ”¾åœ¨åŒä¸€è¡Œ
layout = QHBoxLayout(panel)

# ç”¨æˆ·ä¿¡æ¯
self.user_label = QLabel("æœªç™»å½•")
layout.addWidget(self.user_label)

# å½“å‰é¡¹ç›®æ ‡ç­¾
project_label = QLabel("å½“å‰é¡¹ç›®:")
layout.addWidget(project_label)

# é¡¹ç›®åç§°
self.project_name_value = QLabel("æœªåŠ è½½")
self.project_name_value.setStyleSheet("color: #2196F3; font-size: 14px; font-weight: bold;")
layout.addWidget(self.project_name_value)
```

**Tauri å®ç°**ï¼š

```jsx
<div className="user-info">
  <span>
    ğŸ‘¤ {userInfo?.name || userInfo?.username}
    {userInfo?.role && ` (${getRoleText(userInfo.role)})`}
    {projectInfo && (
      <span style={{ marginLeft: "20px" }}>
        | å½“å‰é¡¹ç›®:{" "}
        <strong style={{ color: "#FFD700" }}>{projectInfo.name}</strong>
      </span>
    )}
  </span>
  <button className="btn-logout" onClick={logout}>
    é€€å‡º
  </button>
</div>
```

**æ˜¾ç¤ºæ•ˆæœ**ï¼š

```
ğŸ“¤ æ–‡ä»¶ä¸Šä¼               ğŸ‘¤ å¾ç»ç† (é¡¹ç›®ç»ç†) | å½“å‰é¡¹ç›®: æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®    [é€€å‡º]
```

### 2. æ•°æ®é¢„è§ˆä½¿ç”¨å®é™…é¡¹ç›®åç§°

**é—®é¢˜**ï¼šExcel è§£ææ—¶ï¼Œé¡¹ç›®åç§°æ˜¯ä» Excel æ–‡ä»¶ä¸­æå–çš„ï¼ˆé€šå¸¸ä¸å‡†ç¡®æˆ–ä¸ºç©ºï¼‰ï¼Œéœ€è¦æ›¿æ¢ä¸ºæ¥å£è¿”å›çš„å®é™…é¡¹ç›®åç§°ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```javascript
const parseExcelFile = async (path) => {
  setParsing(true);
  setMessage("â³ æ­£åœ¨è§£æ Excel æ–‡ä»¶...");
  setParsedReports([]);
  setSelectedReports([]);

  try {
    const result = await excelAPI.parseExcel(path);
    if (result && result.reports) {
      // âœ… ç”¨å®é™…çš„é¡¹ç›®åç§°æ›¿æ¢ Excel ä¸­è§£æçš„é¡¹ç›®åç§°ï¼ˆå‚è€ƒ Python ä»£ç ï¼‰
      const reportsWithProjectName = result.reports.map((report) => ({
        ...report,
        reporterName: projectInfo?.name || report.reporterName,
      }));

      setParsedReports(reportsWithProjectName);
      setMessage(`âœ… è§£ææˆåŠŸï¼æ‰¾åˆ° ${result.reports.length} æ¡æ—¥æŠ¥`);
    } else {
      setMessage("âš ï¸ æœªæ‰¾åˆ°æ—¥æŠ¥æ•°æ®");
    }
  } catch (err) {
    setMessage(`âŒ è§£æå¤±è´¥: ${err.message || err}`);
    console.error("Excel è§£æé”™è¯¯:", err);
  } finally {
    setParsing(false);
  }
};
```

**å…³é”®ç‚¹**ï¼š

- ä½¿ç”¨ `map` éå†è§£æåçš„æŠ¥è¡¨
- ç”¨ `projectInfo?.name` æ›¿æ¢ `report.reporterName`
- å¦‚æœæ²¡æœ‰é¡¹ç›®ä¿¡æ¯ï¼Œä½¿ç”¨åŸå§‹è§£æçš„åç§°ä½œä¸º fallback

### 3. æ ·å¼ä¼˜åŒ–

**æ–‡ä»¶**ï¼š`tauri-app/src/App.css`

```css
.user-info {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-wrap: wrap; /* âœ… å“åº”å¼æ¢è¡Œ */
}

.user-info span {
  display: flex;
  align-items: center;
  gap: 8px; /* âœ… å­å…ƒç´ é—´è· */
}
```

## æ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰

**é¡¶éƒ¨æ˜¾ç¤º**ï¼š

```
ğŸ“¤ æ–‡ä»¶ä¸Šä¼               ğŸ‘¤ å¾ç»ç† (é¡¹ç›®ç»ç†)    [é€€å‡º]
```

**æ•°æ®é¢„è§ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“  æ—¥æœŸ    é¡¹ç›®åç§°  è¿›åº¦  ä»»åŠ¡...   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜  10.1   æœªçŸ¥é¡¹ç›®   æ­£å¸¸   40      â”‚  â† Excel è§£æçš„åç§°
â”‚ â˜  10.2   æœªçŸ¥é¡¹ç›®   æ­£å¸¸   40      â”‚
â”‚ â˜  10.3   æœªçŸ¥é¡¹ç›®   æ­£å¸¸   40      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®æ”¹å

**é¡¶éƒ¨æ˜¾ç¤º**ï¼š

```
ğŸ“¤ æ–‡ä»¶ä¸Šä¼               ğŸ‘¤ å¾ç»ç† (é¡¹ç›®ç»ç†) | å½“å‰é¡¹ç›®: æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®    [é€€å‡º]
                                               â†‘ é‡‘è‰²é«˜äº®æ˜¾ç¤º
```

**æ•°æ®é¢„è§ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“  æ—¥æœŸ    é¡¹ç›®åç§°          è¿›åº¦... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜  10.1   æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®  æ­£å¸¸     â”‚  â† æ¥å£è¿”å›çš„é¡¹ç›®åç§°
â”‚ â˜  10.2   æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®  æ­£å¸¸     â”‚
â”‚ â˜  10.3   æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®  æ­£å¸¸     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æµç¨‹

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. authStore è°ƒç”¨ getProject()
   â†“
3. è·å– projectInfoï¼ˆåŒ…å«é¡¹ç›®åç§°ç­‰ï¼‰
   â†“
4. é¡¶éƒ¨æ˜¾ç¤ºï¼šğŸ‘¤ å¾ç»ç† (é¡¹ç›®ç»ç†) | å½“å‰é¡¹ç›®: æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®
   â†“
5. ç”¨æˆ·é€‰æ‹© Excel æ–‡ä»¶
   â†“
6. è§£æ Excel æ–‡ä»¶
   â†“
7. ç”¨ projectInfo.name æ›¿æ¢è§£æå‡ºçš„é¡¹ç›®åç§°
   â†“
8. æ•°æ®é¢„è§ˆè¡¨æ ¼æ˜¾ç¤ºï¼šæ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®
```

## Python å¯¹ç…§

### Python å®ç°ï¼ˆui/upload_widget.pyï¼‰

```python
def set_user_info(self, user_info: dict, project_info: dict = None):
    """è®¾ç½®ç”¨æˆ·ä¿¡æ¯å’Œé¡¹ç›®ä¿¡æ¯"""
    self.user_info = user_info
    self.project_info = project_info

    # æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼šå§“å + æ‰‹æœºå·
    name = user_info.get('name', 'æœªçŸ¥ç”¨æˆ·')
    phone = user_info.get('phone') or user_info.get('username', '')

    if phone:
        display_text = f"{name} {phone}"
    else:
        display_text = name

    self.user_label.setText(display_text)

    # æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
    if project_info:
        # åªæ˜¾ç¤ºé¡¹ç›®åç§°
        project_name = project_info.get('name', 'æœªçŸ¥é¡¹ç›®')
        self.project_name_value.setText(project_name)  # â† æ˜¾ç¤ºåœ¨ç”¨æˆ·ä¿¡æ¯åŒä¸€è¡Œ
```

### Tauri å®ç°

```jsx
const { token, userInfo, projectInfo, logout, getProject } = useAuthStore();

// é¡¶éƒ¨æ˜¾ç¤º
<span>
  ğŸ‘¤ {userInfo?.name || userInfo?.username}
  {userInfo?.role && ` (${getRoleText(userInfo.role)})`}
  {projectInfo && (
    <span>
      | å½“å‰é¡¹ç›®: <strong>{projectInfo.name}</strong>
    </span>
  )}
</span>;
```

## é¡¹ç›®ä¿¡æ¯ç»“æ„

ä»æ¥å£ `/api/v1/projects/my-project` è¿”å›çš„æ•°æ®ç»“æ„ï¼š

```json
{
  "code": 1,
  "data": {
    "id": 1,
    "name": "æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®",
    "type": "binary_salt",
    "typeDisplayName": "äºŒå…ƒåŒ–ç›é¡¹ç›®",
    "status": "in_progress",
    "statusDisplayName": "è¿›è¡Œä¸­",
    "manager": "å¾ç»ç†",
    "managerId": 10,
    "contactPhone": "13959141232",
    "estimatedSaltAmount": 50.0,
    "actualSaltAmount": 550.0,
    "completionProgress": 999.99,
    "createdAt": "2024-10-15T08:30:00Z",
    "updatedAt": "2024-10-23T10:51:07Z"
  }
}
```

## æµ‹è¯•æ­¥éª¤

1. **ç™»å½•åº”ç”¨**

   - ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•
   - ç¡®è®¤è‡ªåŠ¨è·å–é¡¹ç›®ä¿¡æ¯

2. **æŸ¥çœ‹é¡¶éƒ¨æ˜¾ç¤º**

   - ç¡®è®¤æ˜¾ç¤ºï¼š`ğŸ‘¤ å¾ç»ç† (é¡¹ç›®ç»ç†) | å½“å‰é¡¹ç›®: æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®`
   - é¡¹ç›®åç§°åº”ä¸ºé‡‘è‰²é«˜äº®

3. **é€‰æ‹© Excel æ–‡ä»¶**

   - é€‰æ‹©æµ‹è¯•æ–‡ä»¶ï¼š`assets/æ·®å®‰æ—¥æŠ¥2025.10.19.xlsx`
   - ç­‰å¾…è§£æå®Œæˆ

4. **æŸ¥çœ‹æ•°æ®é¢„è§ˆ**

   - ç¡®è®¤"é¡¹ç›®åç§°"åˆ—å…¨éƒ¨æ˜¾ç¤ºï¼š`æ·®å®‰ç†”ç›å‚¨èƒ½é¡¹ç›®`
   - è€Œä¸æ˜¯ Excel ä¸­çš„"æœªçŸ¥é¡¹ç›®"æˆ–å…¶ä»–åç§°

5. **éªŒè¯ä¸€è‡´æ€§**
   - é¡¶éƒ¨æ˜¾ç¤ºçš„é¡¹ç›®åç§° = é¢„è§ˆè¡¨æ ¼ä¸­çš„é¡¹ç›®åç§°
   - éƒ½æ¥è‡ªæ¥å£è¿”å›çš„ `projectInfo.name`

## ä¼˜åŠ¿

1. **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰åœ°æ–¹æ˜¾ç¤ºçš„é¡¹ç›®åç§°éƒ½æ¥è‡ªæ¥å£ï¼Œç¡®ä¿å‡†ç¡®
2. **ç”¨æˆ·ä½“éªŒ**ï¼šä¸€ç›®äº†ç„¶åœ°çœ‹åˆ°å½“å‰æ“ä½œçš„é¡¹ç›®
3. **å‚è€ƒ Python**ï¼šä¸ Python åº”ç”¨ä¿æŒä¸€è‡´çš„äº¤äº’é€»è¾‘
4. **å®¹é”™å¤„ç†**ï¼šå¦‚æœé¡¹ç›®ä¿¡æ¯æœªåŠ è½½ï¼Œä½¿ç”¨ Excel è§£æçš„åç§°ä½œä¸º fallback

## ç›¸å…³æ–‡ä»¶

- `tauri-app/src/components/UploadForm.jsx` - ä¸»è¦å®ç°
- `tauri-app/src/App.css` - æ ·å¼ä¼˜åŒ–
- `tauri-app/src/stores/authStore.js` - çŠ¶æ€ç®¡ç†
- `ui/upload_widget.py` - Python å‚è€ƒå®ç°

## æ³¨æ„äº‹é¡¹

1. **é¡¹ç›®ä¿¡æ¯åŠ è½½æ—¶æœº**ï¼šç¡®ä¿åœ¨é€‰æ‹©æ–‡ä»¶å‰å·²è·å–é¡¹ç›®ä¿¡æ¯
2. **ç©ºå€¼å¤„ç†**ï¼šä½¿ç”¨å¯é€‰é“¾ `projectInfo?.name` é¿å…é”™è¯¯
3. **é¢œè‰²å¯¹æ¯”**ï¼šé‡‘è‰² `#FFD700` åœ¨ç´«è‰²èƒŒæ™¯ä¸Šå¯¹æ¯”åº¦å¥½ï¼Œæ˜“è¯†åˆ«
4. **å“åº”å¼**ï¼šä½¿ç”¨ `flex-wrap: wrap` ç¡®ä¿å°å±å¹•ä¸Šæ­£å¸¸æ˜¾ç¤º

âœ… **ä¼˜åŒ–å®Œæˆï¼é¡¹ç›®åç§°æ˜¾ç¤ºæ›´åŠ æ¸…æ™°å’Œä¸€è‡´ã€‚**
