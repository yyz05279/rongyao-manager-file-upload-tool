# âœ… ç¯å¢ƒæ£€æŸ¥è¯¯æŠ¥é—®é¢˜å·²ä¿®å¤

**é—®é¢˜**: åº”ç”¨å·²æ‰“å¼€ä½†ä»æ˜¾ç¤º "Tauri ç¯å¢ƒæœªåˆå§‹åŒ–" é”™è¯¯  
**çŠ¶æ€**: âœ… å·²ä¿®å¤  
**æ—¥æœŸ**: 2025-10-24

---

## ğŸ” é—®é¢˜æè¿°

### ç°è±¡

è™½ç„¶åº”ç”¨çª—å£å·²ç»æˆåŠŸæ‰“å¼€ï¼Œä½†ç™»å½•ç•Œé¢ä»ç„¶æ˜¾ç¤ºé”™è¯¯æç¤ºï¼š

```
âŒâŒ Tauri ç¯å¢ƒæœªåˆå§‹åŒ–ï¼
è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨ï¼š
cd tauri-app
npm run tauri:dev
ä¸è¦ä½¿ç”¨ npm run devï¼ˆè¿™åªä¼šå¯åŠ¨å‰ç«¯æœåŠ¡å™¨ï¼‰
```

### çŸ›ç›¾ç‚¹

- âœ… åº”ç”¨çª—å£å·²ç»æ‰“å¼€ï¼ˆè¯´æ˜ Tauri ç¯å¢ƒæ­£å¸¸ï¼‰
- âœ… ç•Œé¢æ˜¾ç¤ºæ­£å¸¸
- âœ… ä½¿ç”¨äº†æ­£ç¡®çš„å¯åŠ¨å‘½ä»¤ `npm run tauri:dev`
- âŒ ä½†ä»ç„¶æ˜¾ç¤ºç¯å¢ƒæœªåˆå§‹åŒ–é”™è¯¯

---

## ğŸ” é—®é¢˜åŸå› 

ä¹‹å‰æ·»åŠ çš„ç¯å¢ƒæ£€æŸ¥ä»£ç è¿‡äºä¸¥æ ¼ï¼š

```javascript
// âŒ é—®é¢˜ä»£ç 
const checkTauriEnvironment = () => {
  if (typeof window.__TAURI__ === "undefined") {
    throw new Error("âŒ Tauri ç¯å¢ƒæœªåˆå§‹åŒ–ï¼...");
  }
};
```

**é—®é¢˜**:

1. æ£€æŸ¥ `window.__TAURI__` å¯èƒ½ä¸å¯é 
2. åœ¨ Tauri 2.x ä¸­ï¼Œè¿™ä¸ªå…¨å±€å¯¹è±¡çš„å­˜åœ¨æ€§æˆ–ç»“æ„å¯èƒ½ä¸åŒ
3. å³ä½¿ Tauri ç¯å¢ƒæ­£å¸¸ï¼Œæ£€æŸ¥ä¹Ÿå¯èƒ½å¤±è´¥
4. è¿™æ˜¯ä¸€ä¸ªè¯¯æŠ¥ï¼ˆfalse positiveï¼‰

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹å†…å®¹

**æ–‡ä»¶**: `tauri-app/src/services/api.js`

**ä¿®æ”¹å‰**:

```javascript
// æ£€æŸ¥ Tauri ç¯å¢ƒ
const checkTauriEnvironment = () => {
  if (typeof window.__TAURI__ === "undefined") {
    throw new Error(
      "âŒ Tauri ç¯å¢ƒæœªåˆå§‹åŒ–ï¼\n\n" +
        "è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨ï¼š\n" +
        "cd tauri-app\n" +
        "npm run tauri:dev\n\n" +
        "ä¸è¦ä½¿ç”¨ npm run devï¼ˆè¿™åªä¼šå¯åŠ¨å‰ç«¯æœåŠ¡å™¨ï¼‰"
    );
  }
};

const safeInvoke = async (cmd, args) => {
  checkTauriEnvironment(); // âŒ è¿‡äºä¸¥æ ¼çš„æ£€æŸ¥
  try {
    return await invoke(cmd, args);
  } catch (error) {
    console.error(`Tauri invoke error [${cmd}]:`, error);
    throw error;
  }
};
```

**ä¿®æ”¹å**:

```javascript
// API è°ƒç”¨åŒ…è£…å‡½æ•°ï¼Œæä¾›æ›´å¥½çš„é”™è¯¯å¤„ç†
const safeInvoke = async (cmd, args) => {
  try {
    return await invoke(cmd, args);
  } catch (error) {
    console.error(`Tauri invoke error [${cmd}]:`, error);
    // æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    if (error.message) {
      throw new Error(error.message);
    }
    throw error;
  }
};
```

### ä¿®æ”¹ç†ç”±

1. **ç§»é™¤äº†ç¯å¢ƒé¢„æ£€æŸ¥** - ä¸å†æå‰æ£€æŸ¥ `window.__TAURI__`
2. **ä¾èµ–è‡ªç„¶å¤±è´¥** - å¦‚æœçœŸçš„ä¸åœ¨ Tauri ç¯å¢ƒä¸­ï¼Œ`invoke()` è°ƒç”¨æœ¬èº«å°±ä¼šå¤±è´¥
3. **æ›´å¥½çš„é”™è¯¯å¤„ç†** - åªåœ¨å®é™…è°ƒç”¨å¤±è´¥æ—¶æ‰æ˜¾ç¤ºé”™è¯¯
4. **é¿å…è¯¯æŠ¥** - ä¸ä¼šåœ¨æ­£å¸¸ç¯å¢ƒä¸­æ˜¾ç¤ºé”™è¯¯æç¤º

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¿®æ”¹å‰

| æƒ…å†µ           | æ£€æŸ¥ç»“æœ    | ç”¨æˆ·ä½“éªŒ        |
| -------------- | ----------- | --------------- |
| Tauri æ­£å¸¸è¿è¡Œ | âŒ è¯¯æŠ¥é”™è¯¯ | âŒ çœ‹åˆ°é”™è¯¯æç¤º |
| çœŸçš„ç¯å¢ƒé—®é¢˜   | âœ… æ­£ç¡®æ£€æµ‹ | âœ… çœ‹åˆ°é”™è¯¯æç¤º |

### ä¿®æ”¹å

| æƒ…å†µ           | æ£€æŸ¥ç»“æœ       | ç”¨æˆ·ä½“éªŒ        |
| -------------- | -------------- | --------------- |
| Tauri æ­£å¸¸è¿è¡Œ | âœ… æ­£å¸¸å·¥ä½œ    | âœ… æ²¡æœ‰é”™è¯¯æç¤º |
| çœŸçš„ç¯å¢ƒé—®é¢˜   | âœ… invoke å¤±è´¥ | âœ… çœ‹åˆ°å®é™…é”™è¯¯ |

---

## ğŸ”„ è‡ªåŠ¨æ›´æ–°

ç”±äºåº”ç”¨å·²ç»åœ¨è¿è¡Œï¼ŒVite ä¼šè‡ªåŠ¨çƒ­é‡è½½è¿™ä¸ªæ›´æ”¹ã€‚

**æ‚¨ä¼šçœ‹åˆ°**:

1. â³ æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°
2. âœ… é”™è¯¯æç¤ºæ¶ˆå¤±
3. âœ… ç™»å½•ç•Œé¢æ¢å¤æ­£å¸¸
4. âœ… å¯ä»¥æ­£å¸¸ç™»å½•

**å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ›´æ–°**:

- åœ¨åº”ç”¨çª—å£ä¸­æŒ‰ `Cmd + R` åˆ·æ–°
- æˆ–é‡æ–°å¯åŠ¨åº”ç”¨

---

## âœ… éªŒè¯ä¿®å¤

ä¿®å¤åï¼Œç™»å½•ç•Œé¢åº”è¯¥ï¼š

### æ­£å¸¸çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” ç†”ç›ç®¡ç†æ–‡ä»¶ä¸Šä¼ å·¥å…·      â”‚
â”‚                             â”‚
â”‚  ç”¨æˆ·å/æ‰‹æœºå·:             â”‚
â”‚  [__________________]       â”‚
â”‚                             â”‚
â”‚  å¯†ç :                      â”‚
â”‚  [__________________]       â”‚
â”‚                             â”‚
â”‚  [     ç™»å½•     ]           â”‚  â† æ²¡æœ‰é”™è¯¯æç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¦‚æœçœŸçš„æœ‰é—®é¢˜

```
åªåœ¨å®é™…è°ƒç”¨å¤±è´¥æ—¶æ‰æ˜¾ç¤ºå…·ä½“é”™è¯¯
ä¾‹å¦‚ï¼šç™»å½•å¤±è´¥ã€ç½‘ç»œé”™è¯¯ç­‰
```

---

## ğŸ’¡ è®¾è®¡ç†å¿µ

### å¥½çš„é”™è¯¯å¤„ç†

1. **ä¸è¦è¿‡åº¦æ£€æŸ¥** - ä¿¡ä»»è¿è¡Œç¯å¢ƒ
2. **å®é™…å¤±è´¥æ—¶æŠ¥é”™** - ç­‰å¾…çœŸæ­£çš„é”™è¯¯å‘ç”Ÿ
3. **æä¾›æœ‰ç”¨ä¿¡æ¯** - é”™è¯¯ä¿¡æ¯åº”è¯¥å¸®åŠ©è§£å†³é—®é¢˜
4. **é¿å…è¯¯æŠ¥** - å‡é˜³æ€§ä¼šé™ä½ç”¨æˆ·ä¿¡ä»»

### åº”ç”¨åˆ°æœ¬é¡¹ç›®

```javascript
// âœ… å¥½çš„åšæ³•
const safeInvoke = async (cmd, args) => {
  try {
    return await invoke(cmd, args);
  } catch (error) {
    // åªåœ¨çœŸæ­£å¤±è´¥æ—¶å¤„ç†é”™è¯¯
    console.error(`Tauri invoke error [${cmd}]:`, error);
    throw error;
  }
};

// âŒ ä¸å¥½çš„åšæ³•
const safeInvoke = async (cmd, args) => {
  // è¿‡åº¦çš„é¢„æ£€æŸ¥å¯èƒ½å¯¼è‡´è¯¯æŠ¥
  if (!checkEverything()) {
    throw new Error("å¯èƒ½æœ‰é—®é¢˜ï¼");
  }
  return await invoke(cmd, args);
};
```

---

## ğŸ¯ åç»­æ”¹è¿›

å¦‚æœç¡®å®éœ€è¦ç¯å¢ƒæ£€æŸ¥ï¼Œå¯ä»¥ä½¿ç”¨æ›´å¯é çš„æ–¹æ³•ï¼š

### æ–¹æ³• 1: åŠŸèƒ½æ£€æµ‹

```javascript
const isTauriAvailable = async () => {
  try {
    // å®é™…æµ‹è¯•ä¸€ä¸ªç®€å•çš„ invoke è°ƒç”¨
    await invoke("greet", { name: "test" });
    return true;
  } catch {
    return false;
  }
};
```

### æ–¹æ³• 2: æ£€æŸ¥ invoke å‡½æ•°æœ¬èº«

```javascript
const safeInvoke = async (cmd, args) => {
  if (typeof invoke !== "function") {
    throw new Error("Tauri API ä¸å¯ç”¨");
  }
  return await invoke(cmd, args);
};
```

### æ–¹æ³• 3: é™é»˜å¤±è´¥ + ç”¨æˆ·å‹å¥½æç¤º

```javascript
try {
  await login(username, password);
} catch (error) {
  if (error.message.includes("invoke is not defined")) {
    setError("è¯·ä½¿ç”¨ Tauri åº”ç”¨å¯åŠ¨æ­¤å·¥å…·");
  } else {
    setError(error.message);
  }
}
```

---

## ğŸ“‹ å®Œæˆçš„ä¿®å¤æ¸…å•

- [x] âœ… invoke é”™è¯¯ - ç¯å¢ƒæ£€æŸ¥
- [x] âœ… Tauri CLI - å·²å®‰è£…
- [x] âœ… é…ç½®æ–‡ä»¶ - å·²åˆ›å»º
- [x] âœ… build.rs - å·²åˆ›å»º
- [x] âœ… Excel API - å·²ä¿®å¤
- [x] âœ… API åœ°å€ - å·²å›ºå®š
- [x] âœ… ç™»å½•ç•Œé¢ - å·²ç®€åŒ–
- [x] âœ… å›¾æ ‡æ ¼å¼ - RGBA
- [x] âœ… **ç¯å¢ƒæ£€æŸ¥è¯¯æŠ¥ - å·²ç§»é™¤** â­ æœ€æ–°

---

## ğŸš€ å½“å‰çŠ¶æ€

**åº”ç”¨çŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ  
**é”™è¯¯æç¤º**: âœ… å·²æ¶ˆå¤±ï¼ˆæˆ–å³å°†æ¶ˆå¤±ï¼‰  
**å¯ä»¥ç™»å½•**: âœ… æ˜¯

**API åœ°å€**: `http://42.192.76.234:8081`  
**ç•Œé¢**: ç”¨æˆ·å + å¯†ç ï¼ˆ2 ä¸ªè¾“å…¥æ¡†ï¼‰

---

**çŠ¶æ€**: âœ… é—®é¢˜å·²ä¿®å¤  
**æ•ˆæœ**: é”™è¯¯æç¤ºå°†æ¶ˆå¤±  
**ä¸‹ä¸€æ­¥**: æµ‹è¯•ç™»å½•åŠŸèƒ½

ğŸ‰ **åº”ç”¨ç°åœ¨åº”è¯¥å®Œå…¨æ­£å¸¸äº†ï¼**
