# 问题反馈数据过滤修复说明

## 问题描述

在上传问题反馈数据时，**"需求描述"** 这个分区标题行被误当作问题记录上传了。

### 错误的上传数据

```json
[
  {
    "problemNo": "2",
    "description": "需求描述",  // ❌ 这是标题，不应该上传
    "reason": "",
    "impact": "紧急程度",
    "progress": ""
  }
]
```

## 根本原因

`_parse_problem_feedbacks()` 方法中的标题行过滤不完整：

**修改前**：
```python
if description in ['问题描述', '问题反馈', '序号']:
    continue
```

这个列表缺少了 **`'需求描述'`**，导致序号为2且描述为"需求描述"的行被当作实际问题记录。

## 修复方案

在标题行过滤中添加 `'需求描述'`：

**修改后**：
```python
if description in ['问题描述', '问题反馈', '序号', '需求描述']:
    continue
```

## 修改内容

### 文件：parse_daily_report_excel.py

#### 方法：`_parse_problem_feedbacks()` 第250行

```python
# 跳过表头行和子标题行
if description in ['问题描述', '问题反馈', '序号', '需求描述']:
    continue
```

## 规则总结

在问题反馈区域（"四"）中需要过滤的标题行：

| 序号 | Description | 说明 | 处理 |
|------|-------------|------|------|
| 1 | "问题描述" | 问题反馈子区域标题 | ❌ 跳过 |
| 2 | "需求描述" | 需求描述子区域标题 | ❌ 跳过 |
| 序号为纯数字的行 | 有内容 | 实际问题/需求记录 | ✅ 上传 |

## 过滤流程

```
┌─ 问题反馈区域（四）
│
├─ 序号1、描述"问题描述" ──→ ❌ 过滤
├─ 序号2、描述"需求描述" ──→ ❌ 过滤（新增）
├─ 序号2、描述"实际问题内容" ──→ ✅ 上传（问题反馈）
├─ 序号3、描述"其他问题" ──→ ✅ 上传（问题反馈）
│
└─ 由 _parse_requirements() 处理需求描述数据
```

## 验证结果

修改后的上传数据应该为：

```json
[
  {
    "problemNo": "2",
    "description": "管道安装进度严重滞后",  // ✅ 实际问题
    "reason": "材料迟迟没到",
    "impact": "影响工期",
    "progress": "已上报"
  },
  {
    "problemNo": "3",
    "description": "人工成本上升",  // ✅ 实际问题
    "reason": "劳动力紧张",
    "impact": "成本增加",
    "progress": "处理中"
  }
]
```

## 影响范围

- ✅ **问题反馈数据**：不再包含"需求描述"标题行
- ✅ **需求描述数据**：由 `_parse_requirements()` 正确处理
- ✅ **API 上传**：问题反馈只包含真实问题数据

## 测试方法

1. **运行Parser**
   ```bash
   python3 parse_daily_report_excel.py <excel文件> output.json
   ```

2. **检查结果**
   ```bash
   grep -A 20 "problemFeedbacks" output.json
   ```

3. **确认**
   - ❌ 不包含 `"description": "需求描述"` 的记录
   - ✅ 只包含真实问题数据

---

**修改日期**：2025-10-23  
**涉及文件**：`parse_daily_report_excel.py`  
**修改位置**：`_parse_problem_feedbacks()` 方法第250行
